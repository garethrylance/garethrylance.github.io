var Ve=Object.defineProperty;var Ye=(r,e,s)=>e in r?Ve(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var ne=(r,e,s)=>Ye(r,typeof e!="symbol"?e+"":e,s);import{z as ze,A as Ge,C as Ke,D as Xe,E as Je,P as Ze,F as et,G as tt,r as o,H as W,J as he,K as ye,L as st,M as Pe,N as qe,O as De,f as de,Q as rt,U as at,V as nt,W as Ie,X as it,Y as ot,B as D,Z as lt,$ as ct,I as xe,a as we,j as t,a0 as pe,S as E,a1 as ge,T as J,u as ut,b as dt,g as gt,h as mt}from"./index-DzaOA67_.js";import{P as pt,d as b,s as R,C as Y,E as ue,S as ft,f as ht,a as V,T as yt}from"./fileValidation-AnOVqnKf.js";import{v as Be,a as xt,u as wt,C as Ct}from"./index-sNGHL25X.js";import{A as Ce}from"./index-oKRoomyI.js";import{R as Qe,L as K,a as Fe,b as St}from"./ThunderboltOutlined-CnzgxFF7.js";import{R as fe,F as bt,B as jt,T as Rt,a as Et,b as Tt}from"./TableView-CUoyUihp.js";import{R as Se}from"./CheckCircleOutlined-Dy24CADW.js";import{R as je,I as me,a as vt}from"./SearchOutlined-bdrymOyE.js";import{A as kt,M as le}from"./index-C7hRAURT.js";import{R as $t,a as zt}from"./EditOutlined-DfIeviW7.js";import{R as Ne}from"./DeleteOutlined-BXI_xhMw.js";import{R as Re}from"./FileOutlined-BhB1Rg8V.js";import{R as Pt}from"./ReloadOutlined-CF9CRRUS.js";import"./row--SaJyCfC.js";const X=r=>r?typeof r=="function"?r():r:null,qt=r=>{const{componentCls:e,popoverColor:s,titleMinWidth:n,fontWeightStrong:i,innerPadding:a,boxShadowSecondary:h,colorTextHeading:c,borderRadiusLG:d,zIndexPopup:m,titleMarginBottom:g,colorBgElevated:x,popoverBg:S,titleBorderBottom:w,innerContentPadding:C,titlePadding:p}=r;return[{[e]:{...Xe(r),position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:m,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"--antd-arrow-background-color":x,width:"max-content",maxWidth:"100vw","&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${e}-content`]:{position:"relative"},[`${e}-container`]:{backgroundColor:S,backgroundClip:"padding-box",borderRadius:d,boxShadow:h,padding:a},[`${e}-title`]:{minWidth:n,marginBottom:g,color:c,fontWeight:i,borderBottom:w,padding:p},[`${e}-content`]:{color:s,padding:C}}},Je(r,"var(--antd-arrow-background-color)"),{[`${e}-pure`]:{position:"relative",maxWidth:"none",margin:r.sizePopupArrow,display:"inline-block"}}]},Dt=r=>{const{componentCls:e}=r;return{[e]:Ze.map(s=>{const n=r[`${s}6`];return{[`&${e}-${s}`]:{"--antd-arrow-background-color":n,[`${e}-inner`]:{backgroundColor:n},[`${e}-arrow`]:{background:"transparent"}}}})}},It=r=>{const{lineWidth:e,controlHeight:s,fontHeight:n,padding:i,wireframe:a,zIndexPopupBase:h,borderRadiusLG:c,marginXS:d,lineType:m,colorSplit:g,paddingSM:x}=r,S=s-n,w=S/2,C=S/2-e,p=i;return{titleMinWidth:177,zIndexPopup:h+30,...tt(r),...et({contentRadius:c,limitVerticalRadius:!0}),innerPadding:a?0:12,titleMarginBottom:a?0:d,titlePadding:a?`${w}px ${p}px ${C}px`:0,titleBorderBottom:a?`${e}px ${m} ${g}`:"none",innerContentPadding:a?`${x}px ${p}px`:0}},Me=ze("Popover",r=>{const{colorBgElevated:e,colorText:s}=r,n=Ge(r,{popoverBg:e,popoverColor:s});return[qt(n),Dt(n),Ke(n,"zoom-big")]},It,{resetStyle:!1,deprecatedTokens:[["width","titleMinWidth"],["minWidth","titleMinWidth"]]}),Ae=r=>{const{title:e,content:s,prefixCls:n,classNames:i,styles:a}=r;return!e&&!s?null:o.createElement(o.Fragment,null,e&&o.createElement("div",{className:W(`${n}-title`,i==null?void 0:i.title),style:a==null?void 0:a.title},e),s&&o.createElement("div",{className:W(`${n}-content`,i==null?void 0:i.content),style:a==null?void 0:a.content},s))},Bt=r=>{const{hashId:e,prefixCls:s,className:n,style:i,placement:a="top",title:h,content:c,children:d,classNames:m,styles:g}=r,x=X(h),S=X(c),w={...r,placement:a},[C,p]=ye([m],[g],{props:w}),f=W(e,s,`${s}-pure`,`${s}-placement-${a}`,n);return o.createElement("div",{className:f,style:i},o.createElement("div",{className:`${s}-arrow`}),o.createElement(st,{...r,className:e,prefixCls:s,classNames:C,styles:p},d||o.createElement(Ae,{prefixCls:s,title:x,content:S,classNames:C,styles:p})))},Oe=r=>{const{prefixCls:e,className:s,...n}=r,{getPrefixCls:i}=o.useContext(he),a=i("popover",e),[h,c]=Me(a);return o.createElement(Bt,{...n,prefixCls:a,hashId:h,className:W(s,c)})},Qt=o.forwardRef((r,e)=>{const{prefixCls:s,title:n,content:i,overlayClassName:a,placement:h="top",trigger:c,children:d,mouseEnterDelay:m=.1,mouseLeaveDelay:g=.1,onOpenChange:x,overlayStyle:S={},styles:w,classNames:C,motion:p,arrow:f,...l}=r,{getPrefixCls:u,className:y,style:T,classNames:k,styles:P,arrow:I,trigger:Z}=Pe("popover"),B=u("popover",s),[N,ee]=Me(B),te=u(),se=qe(f,I),G=c||Z||"hover",M={...r,placement:h,trigger:G,mouseEnterDelay:m,mouseLeaveDelay:g,overlayStyle:S,styles:w,classNames:C},[A,q]=ye([k,C],[P,w],{props:M}),_=W(a,N,ee,y,A.root),[re,$]=De(r.defaultOpen??!1,r.open),j=(v,oe)=>{$(v),x==null||x(v,oe)},O=v=>{v.keyCode===nt.ESC&&j(!1,v)},ae=v=>{j(v)},H=X(n),L=X(i);return o.createElement(de,{unique:!1,arrow:se,placement:h,trigger:G,mouseEnterDelay:m,mouseLeaveDelay:g,...l,prefixCls:B,classNames:{root:_,container:A.container,arrow:A.arrow},styles:{root:{...q.root,...T,...S},container:q.container,arrow:q.arrow},ref:e,open:re,onOpenChange:ae,overlay:H||L?o.createElement(Ae,{prefixCls:B,title:H,content:L,classNames:A,styles:q}):null,motion:{motionName:rt(te,"zoom-big",typeof(p==null?void 0:p.motionName)=="string"?p==null?void 0:p.motionName:void 0)},"data-popover-inject":!0},at(d,{onKeyDown:v=>{var oe,be;o.isValidElement(d)&&((be=d==null?void 0:(oe=d.props).onKeyDown)==null||be.call(oe,v)),O(v)}}))}),Le=Qt;Le._InternalPanelDoNotUseOrYouWillBeFired=Oe;var Ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M686.7 638.6L544.1 535.5V288c0-4.4-3.6-8-8-8H488c-4.4 0-8 3.6-8 8v275.4c0 2.6 1.2 5 3.3 6.5l165.4 120.6c3.6 2.6 8.6 1.8 11.2-1.7l28.6-39c2.6-3.7 1.8-8.7-1.8-11.2z"}}]},name:"clock-circle",theme:"outlined"},Nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const Mt=r=>{const{componentCls:e,iconCls:s,antCls:n,zIndexPopup:i,colorText:a,colorWarning:h,marginXXS:c,marginXS:d,fontSize:m,fontWeightStrong:g,colorTextHeading:x}=r;return{[e]:{zIndex:i,[`&${n}-popover`]:{fontSize:m},[`${e}-message`]:{marginBottom:d,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${e}-message-icon ${s}`]:{color:h,fontSize:m,lineHeight:1,marginInlineEnd:d},[`${e}-title`]:{fontWeight:g,color:x,"&:only-child":{fontWeight:"normal"}},[`${e}-description`]:{marginTop:c,color:a}},[`${e}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:d}}}}},At=r=>{const{zIndexPopupBase:e}=r;return{zIndexPopup:e+60}},We=ze("Popconfirm",r=>Mt(r),At,{resetStyle:!1}),_e=r=>{const{prefixCls:e,okButtonProps:s,cancelButtonProps:n,title:i,description:a,cancelText:h,okText:c,okType:d="primary",icon:m=o.createElement(Ie,null),showCancel:g=!0,close:x,onConfirm:S,onCancel:w,onPopupClick:C,classNames:p,styles:f}=r,{getPrefixCls:l}=o.useContext(he),[u]=it("Popconfirm",ot.Popconfirm),y=X(i),T=X(a);return o.createElement("div",{className:`${e}-inner-content`,onClick:C},o.createElement("div",{className:`${e}-message`},m&&o.createElement("span",{className:`${e}-message-icon`},m),o.createElement("div",{className:`${e}-message-text`},y&&o.createElement("div",{className:W(`${e}-title`,p==null?void 0:p.title),style:f==null?void 0:f.title},y),T&&o.createElement("div",{className:W(`${e}-description`,p==null?void 0:p.content),style:f==null?void 0:f.content},T))),o.createElement("div",{className:`${e}-buttons`},g&&o.createElement(D,{onClick:w,size:"small",...n},h||(u==null?void 0:u.cancelText)),o.createElement(kt,{buttonProps:{size:"small",...lt(d),...s},actionFn:S,close:x,prefixCls:l("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},c||(u==null?void 0:u.okText))))},Ot=r=>{const{prefixCls:e,placement:s,className:n,style:i,...a}=r,{getPrefixCls:h}=o.useContext(he),c=h("popconfirm",e);return We(c),o.createElement(Oe,{placement:s,className:W(c,n),style:i,content:o.createElement(_e,{prefixCls:c,...a})})},Lt=o.forwardRef((r,e)=>{const{prefixCls:s,placement:n="top",trigger:i,okType:a="primary",icon:h=o.createElement(Ie,null),children:c,overlayClassName:d,onOpenChange:m,overlayStyle:g,styles:x,arrow:S,classNames:w,...C}=r,{getPrefixCls:p,className:f,style:l,classNames:u,styles:y,arrow:T,trigger:k}=Pe("popconfirm"),[P,I]=De(r.defaultOpen??!1,r.open),Z=qe(S,T),B=i||k||"click",N=($,j)=>{I($),m==null||m($,j)},ee=$=>{N(!1,$)},te=$=>{var j;return(j=r.onConfirm)==null?void 0:j.call(void 0,$)},se=$=>{var j;N(!1,$),(j=r.onCancel)==null||j.call(void 0,$)},G=($,j)=>{const{disabled:O=!1}=r;O||N($,j)},M=p("popconfirm",s),A={...r,placement:n,trigger:B,okType:a,overlayStyle:g,styles:x,classNames:w},[q,_]=ye([u,w],[y,x],{props:A}),re=W(M,f,d,q.root);return We(M),o.createElement(Le,{arrow:Z,...ct(C,["title"]),trigger:B,placement:n,onOpenChange:G,open:P,ref:e,classNames:{root:re,container:q.container,arrow:q.arrow},styles:{root:{...l,..._.root,...g},container:_.container,arrow:_.arrow},content:o.createElement(_e,{okType:a,icon:h,...r,prefixCls:M,close:ee,onConfirm:te,onCancel:se,classNames:q,styles:_}),"data-popover-inject":!0},c)}),He=Lt;He._InternalPanelDoNotUseOrYouWillBeFired=Ot;var Wt=function(e,s){return o.createElement(xe,we({},e,{ref:s,icon:Ft}))},_t=o.forwardRef(Wt),Ht=function(e,s){return o.createElement(xe,we({},e,{ref:s,icon:Nt}))},Ut=o.forwardRef(Ht),Vt=function(e,s){return o.createElement(xe,we({},e,{ref:s,icon:pt}))},Ee=o.forwardRef(Vt);class z{static async initialize(e){var s,n;if(this.status!=="ready"){if(this.status==="initializing")return new Promise((i,a)=>{const h=setInterval(()=>{this.status==="ready"?(clearInterval(h),i()):this.status==="error"&&(clearInterval(h),a(new Error("DuckDB initialization failed")))},100)});this.status="initializing",this.progressCallback=e||null;try{this.worker=new Worker(new URL(""+new URL("duckdb.worker-CEs9AVLp.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=a=>{this.handleWorkerMessage(a.data)},this.worker.onerror=a=>{console.error("DuckDB worker error:",a),this.status="error"};const i=this.sendMessage("init","initialized");(s=this.progressCallback)==null||s.call(this,"Initializing DuckDB..."),await i,this.status="ready",(n=this.progressCallback)==null||n.call(this,"DuckDB ready")}catch(i){throw this.status="error",new Error(`Failed to initialize DuckDB: ${i instanceof Error?i.message:String(i)}`)}}}static async registerParquetFile(e){var n,i;if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");if(e.fileType!=="parquet")throw new Error("Only Parquet files can be registered");if(!(e.content instanceof ArrayBuffer))throw new Error("Parquet file content must be ArrayBuffer");const s=this.sanitizeTableName(e.name);(n=this.progressCallback)==null||n.call(this,`Registering ${s}...`);try{return await this.sendMessage("register","registered",{tableName:s,fileContent:e.content}),(i=this.progressCallback)==null||i.call(this,`Table ${s} registered`),s}catch(a){throw new Error(`Failed to register file: ${a instanceof Error?a.message:String(a)}`)}}static async registerFileForScript(e){var n,i;if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");if(e.fileType!=="parquet")throw new Error("Only Parquet files can be registered");if(!(e.content instanceof ArrayBuffer))throw new Error("Parquet file content must be ArrayBuffer");const s=this.sanitizeTableName(e.name);(n=this.progressCallback)==null||n.call(this,`Registering ${s} for script...`);try{return await this.sendMessage("register","registered",{tableName:s,fileContent:e.content}),(i=this.progressCallback)==null||i.call(this,`Table ${s} registered`),s}catch(a){throw new Error(`Failed to register file: ${a instanceof Error?a.message:String(a)}`)}}static async unregisterScriptTables(e){var s;if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");try{const i=(await this.listTables()).filter(a=>a.startsWith(`${e}_`));for(const a of i)await this.dropTable(a);(s=this.progressCallback)==null||s.call(this,`Unregistered ${i.length} tables for script`)}catch(n){throw new Error(`Failed to unregister script tables: ${n instanceof Error?n.message:String(n)}`)}}static getFriendlyTableName(e){const s=e.split("_");return s.length>1?s.slice(1).join("_"):e}static async executeQuery(e){var s,n;if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");this.status="executing",(s=this.progressCallback)==null||s.call(this,"Executing query...");try{const i=await this.sendMessage("execute","result",{query:e});this.status="ready";const a=i.executionTime??0;return(n=this.progressCallback)==null||n.call(this,`Query completed in ${a.toFixed(2)}ms`),{data:i.data,executionTime:a}}catch(i){throw this.status="ready",new Error(`Query execution failed: ${i instanceof Error?i.message:String(i)}`)}}static async getTableSchema(e){if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");try{return(await this.sendMessage("schema","schema",{tableName:e})).data}catch(s){throw new Error(`Failed to get schema: ${s instanceof Error?s.message:String(s)}`)}}static async listTables(){if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");try{return(await this.sendMessage("list","list")).data.map(s=>s.name)}catch(e){throw new Error(`Failed to list tables: ${e instanceof Error?e.message:String(e)}`)}}static async dropTable(e){var s;if(this.status!=="ready")throw new Error("DuckDB not initialized. Call initialize() first.");try{await this.sendMessage("drop","dropped",{tableName:e}),(s=this.progressCallback)==null||s.call(this,`Table ${e} dropped`)}catch(n){throw new Error(`Failed to drop table: ${n instanceof Error?n.message:String(n)}`)}}static getStatus(){return this.status}static setProgressCallback(e){this.progressCallback=e}static terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.status="idle",this.messageHandlers.clear(),this.progressCallback=null)}static sendMessage(e,s,n){return new Promise((i,a)=>{const h=`${e}-${Date.now()}-${Math.random()}`;this.messageHandlers.set(h,c=>{c.type===s?(this.messageHandlers.delete(h),i({data:c.data,executionTime:c.executionTime})):c.type==="error"&&(this.messageHandlers.delete(h),a(new Error(c.error||"Unknown error")))}),this.worker.postMessage({type:e,payload:n}),setTimeout(()=>{this.messageHandlers.has(h)&&(this.messageHandlers.delete(h),a(new Error(`Message timeout: ${e}`)))},3e4)})}static handleWorkerMessage(e){var s;if(e.type==="progress"){(s=this.progressCallback)==null||s.call(this,e.message||"");return}e.type==="error"&&console.error("DuckDB worker error:",e.error),this.messageHandlers.forEach(n=>{n(e)})}static sanitizeTableName(e){return e.replace(/\.parquet$/i,"").replace(/[^a-zA-Z0-9_]/g,"_").replace(/^[0-9]/,"_$&").toLowerCase()}}ne(z,"worker",null),ne(z,"status","idle"),ne(z,"messageHandlers",new Map),ne(z,"progressCallback",null);function Yt(){const[r,e]=o.useState("idle"),[s,n]=o.useState([]),[i,a]=o.useState(null),[h,c]=o.useState(""),d=o.useCallback(async()=>{try{a(null);const l=await z.listTables();n(l)}catch(l){console.warn("Failed to list tables:",l)}},[]),m=o.useCallback(async()=>{try{a(null),e("initializing"),z.setProgressCallback(l=>{c(l)}),await z.initialize(l=>{c(l)}),e("ready"),c("DuckDB initialized successfully"),await d()}catch(l){const u=l instanceof Error?l.message:"Failed to initialize DuckDB";a(u),e("error"),c("")}},[d]),g=o.useCallback(async l=>{try{a(null);const u=await z.registerParquetFile(l);return await d(),u}catch(u){const y=u instanceof Error?u.message:"Failed to register file";throw a(y),u}},[d]),x=o.useCallback(async l=>{try{a(null);const u=await z.registerFileForScript(l);return await d(),u}catch(u){const y=u instanceof Error?u.message:"Failed to register file for script";throw a(y),u}},[d]),S=o.useCallback(async l=>{try{a(null),await z.unregisterScriptTables(l),await d()}catch(u){const y=u instanceof Error?u.message:"Failed to unregister script tables";throw a(y),u}},[d]),w=o.useCallback(async l=>{try{a(null),e("executing");const u=await z.executeQuery(l);return e("ready"),u}catch(u){const y=u instanceof Error?u.message:"Query execution failed";throw a(y),e("ready"),u}},[]),C=o.useCallback(async l=>{try{return a(null),await z.getTableSchema(l)}catch(u){const y=u instanceof Error?u.message:"Failed to get schema";throw a(y),u}},[]),p=o.useCallback(async l=>{try{a(null),await z.dropTable(l),await d()}catch(u){const y=u instanceof Error?u.message:"Failed to drop table";throw a(y),u}},[d]),f=o.useCallback(()=>{z.terminate(),e("idle"),n([]),a(null),c("")},[]);return o.useEffect(()=>{e(z.getStatus())},[]),{status:r,tables:s,error:i,progressMessage:h,initialize:m,registerFile:g,registerFileForScript:x,unregisterScriptTables:S,executeQuery:w,getSchema:C,listTables:d,dropTable:p,terminate:f}}class F{static async createScript(e){const s=e||`Script ${new Date().toLocaleString()}`,n={id:Be(),name:s,fileIds:[],registeredTables:[],query:this.getDefaultQuery([]),createdAt:new Date,updatedAt:new Date};return await b.sqlQueries.add(n),n}static async renameScript(e,s){await b.sqlQueries.update(e,{name:s,updatedAt:new Date});const n=await b.sqlQueries.get(e);if(!n)throw new Error("Failed to rename script");return n}static async saveQuery(e,s,n,i){await b.sqlQueries.update(e,{fileIds:s,registeredTables:n,query:i,updatedAt:new Date});const a=await b.sqlQueries.get(e);if(!a)throw new Error("Failed to update query");return a}static async getQuery(e){return b.sqlQueries.get(e)}static async getAllScripts(){return b.sqlQueries.orderBy("updatedAt").reverse().toArray()}static async getScriptByName(e){return b.sqlQueries.where("name").equals(e).first()}static async deleteQuery(e){await b.transaction("rw",[b.sqlQueries,b.sqlQueryResults],async()=>{await b.sqlQueries.delete(e),await b.sqlQueryResults.where("queryId").equals(e).delete()})}static async updateRegisteredTables(e,s){await b.sqlQueries.update(e,{registeredTables:s,updatedAt:new Date})}static async updateFileIds(e,s){await b.sqlQueries.update(e,{fileIds:s,updatedAt:new Date})}static getDefaultQuery(e){return e.length===0?`-- Select one or more Parquet files to start querying
`:e.length===1?`-- Query ${e[0]}
SELECT * FROM ${e[0]} LIMIT 100;`:`-- Query multiple tables with JOIN
SELECT *
FROM ${e[0]} t1
JOIN ${e[1]} t2 ON t1.id = t2.id
LIMIT 100;`}}const Gt=2e3;function Kt(r,e=[]){const[s,n]=o.useState(""),[i,a]=o.useState(!1),[h,c]=o.useState(!1),[d,m]=o.useState(null),g=o.useRef(null),x=o.useRef(""),S=o.useRef(null);o.useEffect(()=>{S.current=r},[r]),o.useEffect(()=>{r?(n(r.query),x.current=r.query,a(!1)):(n(F.getDefaultQuery([])),x.current="",a(!1))},[r]);const w=o.useCallback(async l=>{const u=S.current;if(u)try{c(!0),m(null),await F.saveQuery(u.id,u.fileIds,u.registeredTables,l),x.current=l,a(!1)}catch(y){const T=y instanceof Error?y.message:"Failed to save query";m(T)}finally{c(!1)}},[]),C=o.useCallback(l=>{n(l),a(l!==x.current),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{w(l)},Gt)},[w]),p=o.useCallback(async()=>{g.current&&(clearTimeout(g.current),g.current=null),await w(s)},[s,w]),f=o.useCallback(()=>{const l=F.getDefaultQuery(e);n(l),x.current="",a(!0)},[e]);return o.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]),{query:s,isDirty:i,isSaving:h,error:d,updateQuery:C,saveQuery:p,resetQuery:f}}function Xt(){const r=xt(()=>F.getAllScripts())??[],[e,s]=o.useState(null),[n,i]=o.useState(!1),a=o.useCallback(async m=>{i(!0);try{const g=await F.createScript(m);return s(g),R.success(`Created script: ${g.name}`),g}catch(g){throw R.error("Failed to create script"),console.error("Failed to create script:",g),g}finally{i(!1)}},[]),h=o.useCallback(async m=>{i(!0);try{const g=await F.getQuery(m);g?s(g):R.error("Script not found")}catch(g){R.error("Failed to load script"),console.error("Failed to load script:",g)}finally{i(!1)}},[]),c=o.useCallback(async(m,g)=>{i(!0);try{const x=await F.renameScript(m,g);(e==null?void 0:e.id)===m&&s(x),R.success("Script renamed successfully")}catch(x){R.error("Failed to rename script"),console.error("Failed to rename script:",x)}finally{i(!1)}},[e]),d=o.useCallback(async m=>{i(!0);try{await F.deleteQuery(m),(e==null?void 0:e.id)===m&&s(null),R.success("Script deleted successfully")}catch(g){R.error("Failed to delete script"),console.error("Failed to delete script:",g)}finally{i(!1)}},[e]);return o.useEffect(()=>{!e&&r.length>0&&s(r[0])},[r,e]),{scripts:r,currentScript:e,loading:n,createScript:a,selectScript:h,renameScript:c,deleteScript:d}}const Te=10;class ie{static async saveResult(e,s,n,i,a,h){const c={id:Be(),queryId:e,querySnapshot:s,result:n,executionTime:i,status:a,errorMessage:h,executedAt:new Date};return await b.transaction("rw",b.sqlQueryResults,async()=>{await b.sqlQueryResults.add(c);const d=await b.sqlQueryResults.where("queryId").equals(e).reverse().sortBy("executedAt");if(d.length>Te){const m=d.slice(Te);for(const g of m)await b.sqlQueryResults.delete(g.id)}}),c}static async getResult(e){return b.sqlQueryResults.get(e)}static async getResultsByQuery(e){return b.sqlQueryResults.where("queryId").equals(e).reverse().sortBy("executedAt")}static async getMostRecentResult(e){return(await b.sqlQueryResults.where("queryId").equals(e).reverse().sortBy("executedAt"))[0]}static async getAllResults(){return b.sqlQueryResults.orderBy("executedAt").reverse().toArray()}static async deleteResult(e){await b.sqlQueryResults.delete(e)}static async deleteResultsForQuery(e){await b.sqlQueryResults.where("queryId").equals(e).delete()}static async getResultCount(e){return b.sqlQueryResults.where("queryId").equals(e).count()}static async getSuccessfulExecutionCount(e){return(await this.getResultsByQuery(e)).filter(n=>n.status==="success").length}static async getAverageExecutionTime(e){const n=(await this.getResultsByQuery(e)).filter(a=>a.status==="success");return n.length===0?0:n.reduce((a,h)=>a+h.executionTime,0)/n.length}static async getResultStats(e){const s=await this.getResultsByQuery(e),n=s.filter(a=>a.status==="success"),i=n.reduce((a,h)=>a+h.executionTime,0);return{count:s.length,successCount:n.length,avgExecutionTime:n.length>0?i/n.length:0}}}function Jt(){const[r,e]=o.useState([]),[s,n]=o.useState(null),[i,a]=o.useState(!1),[h,c]=o.useState(null),d=o.useCallback(async p=>{try{a(!0),c(null);const f=await ie.getResultsByQuery(p);e(f),f.length>0?n(f[0]):n(null)}catch(f){const l=f instanceof Error?f.message:"Failed to load results";c(l)}finally{a(!1)}},[]),m=o.useCallback(p=>{const f=r.find(l=>l.id===p);f&&n(f)},[r]),g=o.useCallback(()=>{r.length>0&&n(r[0])},[r]),x=o.useCallback(async(p,f,l,u,y,T)=>{try{c(null);const k=await ie.saveResult(p,f,l,u,y,T);return await d(p),n(k),k}catch(k){const P=k instanceof Error?k.message:"Failed to save result";throw c(P),k}},[d]),S=o.useCallback(async p=>{try{c(null),await ie.deleteResult(p),e(f=>f.filter(l=>l.id!==p)),(s==null?void 0:s.id)===p&&n(null)}catch(f){const l=f instanceof Error?f.message:"Failed to delete result";throw c(l),f}},[s]),w=o.useCallback(async p=>{try{c(null),await ie.deleteResultsForQuery(p),e([]),n(null)}catch(f){const l=f instanceof Error?f.message:"Failed to clear results";throw c(l),f}},[]),C=o.useCallback(async p=>{try{c(null);const f=await ie.getResultStats(p);return{count:f.count,successCount:f.successCount,avgTime:f.avgExecutionTime}}catch(f){const l=f instanceof Error?f.message:"Failed to get result stats";throw c(l),f}},[]);return{results:r,selectedResult:s,isLoading:i,error:h,loadResults:d,selectResult:m,selectMostRecent:g,saveResult:x,deleteResult:S,clearResults:w,getResultStats:C}}const Zt=({status:r,message:e,tableCount:s=0})=>{const n=()=>{if(e)return e;switch(r){case"idle":return"DuckDB not initialized";case"initializing":return"Initializing DuckDB...";case"ready":return`DuckDB ready${s>0?` (${s} ${s===1?"table":"tables"} registered)`:""}`;case"executing":return"Executing query...";case"error":return"DuckDB error";default:return"Unknown status"}},i=()=>{switch(r){case"idle":return t.jsx(Ut,{});case"initializing":return t.jsx(pe,{indicator:t.jsx(fe,{spin:!0})});case"ready":return t.jsx(Se,{});case"executing":return t.jsx(pe,{indicator:t.jsx(fe,{spin:!0})});case"error":return t.jsx(Qe,{});default:return null}},a=()=>{switch(r){case"idle":return"info";case"initializing":return"info";case"ready":return"success";case"executing":return"info";case"error":return"error";default:return"info"}};return t.jsx(Ce,{message:n(),type:a(),icon:i(),showIcon:!0,style:{marginBottom:16}})},{Title:ve,Text:ke}=J,es=({status:r,progressMessage:e,children:s})=>r==="ready"||r==="executing"?t.jsx(t.Fragment,{children:s}):r==="idle"||r==="initializing"?t.jsx(Y,{children:t.jsxs(E,{orientation:"vertical",size:"large",style:{width:"100%",textAlign:"center"},children:[t.jsx(pe,{indicator:t.jsx(fe,{style:{fontSize:48},spin:!0}),tip:e||"Initializing DuckDB...",children:t.jsx("div",{style:{padding:50},children:t.jsx(ge,{style:{fontSize:64,color:"#1890ff",opacity:.3}})})}),t.jsxs("div",{children:[t.jsx(ve,{level:4,children:"Setting up SQL Engine"}),t.jsx(ke,{type:"secondary",children:e||"Please wait while DuckDB initializes..."})]})]})}):r==="error"?t.jsx(Y,{children:t.jsxs(E,{orientation:"vertical",size:"large",style:{width:"100%",textAlign:"center"},children:[t.jsx(ge,{style:{fontSize:64,color:"#ff4d4f"}}),t.jsxs("div",{children:[t.jsx(ve,{level:4,children:"Failed to Initialize DuckDB"}),t.jsx(ke,{type:"danger",children:e||"An error occurred while initializing the SQL engine."})]})]})}):null,{Text:Q}=J,Ue=o.memo(({scripts:r,currentScript:e,loading:s,onSelectScript:n,onCreateScript:i,onRenameScript:a,onDeleteScript:h})=>{const[c,d]=o.useState(!1),[m,g]=o.useState(!1),[x,S]=o.useState(""),[w,C]=o.useState(""),p=()=>{i(x||void 0),S(""),d(!1)},f=()=>{e&&w.trim()&&(a(e.id,w),C(""),g(!1))},l=()=>{e&&le.confirm({title:"Delete Script",content:`Are you sure you want to delete "${e.name}"? This will also delete all query results for this script.`,okText:"Delete",okType:"danger",onOk:()=>{h(e.id)}})},u=()=>{C((e==null?void 0:e.name)||""),g(!0)};return r.length===0?t.jsxs(Y,{children:[t.jsx(ue,{image:t.jsx(je,{style:{fontSize:48,color:"#bfbfbf"}}),description:t.jsxs(E,{orientation:"vertical",size:"small",children:[t.jsx(Q,{children:"No SQL scripts yet"}),t.jsx(Q,{type:"secondary",style:{fontSize:12},children:"Create your first script to start querying Parquet files with SQL"})]}),children:t.jsx(D,{type:"primary",icon:t.jsx(Ee,{}),onClick:()=>d(!0),loading:s,children:"Create First Script"})}),t.jsx(le,{title:"Create New Script",open:c,onOk:p,onCancel:()=>d(!1),okText:"Create",children:t.jsxs(E,{orientation:"vertical",style:{width:"100%"},children:[t.jsx(Q,{children:"Script Name (optional)"}),t.jsx(me,{placeholder:"e.g., Sales Analysis Q4",value:x,onChange:y=>S(y.target.value),onPressEnter:p,autoFocus:!0}),t.jsx(Q,{type:"secondary",style:{fontSize:12},children:"Leave empty for auto-generated name"})]})})]}):t.jsxs(Y,{children:[t.jsxs(E,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(E,{children:[t.jsx(je,{style:{fontSize:16}}),t.jsx(Q,{strong:!0,children:"SQL Scripts"}),t.jsxs(Q,{type:"secondary",children:["(",r.length,")"]})]}),t.jsx(D,{type:"primary",icon:t.jsx(Ee,{}),size:"small",onClick:()=>d(!0),loading:s,children:"New Script"})]}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx(ft,{style:{flex:1},placeholder:"Select a script",value:e==null?void 0:e.id,onChange:n,loading:s,options:r.map(y=>({label:y.name,value:y.id}))}),e&&t.jsxs(t.Fragment,{children:[t.jsx(de,{title:"Rename Script",children:t.jsx(D,{icon:t.jsx($t,{}),onClick:u,disabled:s})}),t.jsx(de,{title:"Delete Script",children:t.jsx(D,{danger:!0,icon:t.jsx(Ne,{}),onClick:l,disabled:s})})]})]}),e&&t.jsx("div",{children:t.jsxs(Q,{type:"secondary",style:{fontSize:12},children:["Last updated: ",new Date(e.updatedAt).toLocaleString()]})})]}),t.jsx(le,{title:"Create New Script",open:c,onOk:p,onCancel:()=>{d(!1),S("")},okText:"Create",children:t.jsxs(E,{orientation:"vertical",style:{width:"100%"},children:[t.jsx(Q,{children:"Script Name (optional)"}),t.jsx(me,{placeholder:"e.g., Sales Analysis Q4",value:x,onChange:y=>S(y.target.value),onPressEnter:p,autoFocus:!0}),t.jsx(Q,{type:"secondary",style:{fontSize:12},children:"Leave empty for auto-generated name"})]})}),t.jsx(le,{title:"Rename Script",open:m,onOk:f,onCancel:()=>{g(!1),C("")},okText:"Rename",children:t.jsxs(E,{orientation:"vertical",style:{width:"100%"},children:[t.jsx(Q,{children:"New Script Name"}),t.jsx(me,{placeholder:"Enter new script name",value:w,onChange:y=>C(y.target.value),onPressEnter:f,autoFocus:!0})]})})]})});Ue.displayName="ScriptSelector";const{Text:U}=J,ts=({selectedFileIds:r,onFileSelect:e,registeredTables:s,onRegisterFiles:n,currentScript:i})=>{const a=ut(),{files:h,deleteFile:c}=wt(),[d,m]=o.useState([]),[g,x]=o.useState(!1);o.useEffect(()=>{m(h.filter(l=>l.fileType==="parquet"))},[h]);const S=l=>{r.includes(l)?e(r.filter(u=>u!==l)):e([...r,l])},w=async l=>{try{await c(l),R.success("File deleted"),e(r.filter(u=>u!==l))}catch{R.error("Failed to delete file")}},C=async()=>{const l=d.filter(u=>r.includes(u.id));if(l.length===0){R.warning("Please select at least one file");return}try{x(!0),await n(l),R.success(`Registered ${l.length} ${l.length===1?"table":"tables"}`)}catch{R.error("Failed to register files")}finally{x(!1)}},p=l=>{if(!i)return!1;const u=l.name.replace(/\.parquet$/i,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),y=`${i.id}_${u}`;return s.includes(y)},f=l=>i?i.fileIds.includes(l):!1;return t.jsx(Y,{title:t.jsxs(E,{children:[t.jsx(Re,{}),t.jsx(U,{children:"Parquet Files"}),t.jsx(V,{color:"blue",children:d.length})]}),extra:t.jsx(D,{icon:t.jsx(dt,{}),size:"small",onClick:()=>a("/files"),children:"Manage Files"}),style:{height:"100%",display:"flex",flexDirection:"column"},bodyStyle:{flex:1,overflow:"auto"},children:d.length===0?t.jsxs("div",{style:{textAlign:"center",padding:32},children:[t.jsx(Re,{style:{fontSize:48,color:"#ccc",marginBottom:16}}),t.jsx(U,{type:"secondary",children:"No Parquet files uploaded"}),t.jsx("br",{}),t.jsx(U,{type:"secondary",style:{fontSize:12},children:"Upload Parquet files from the Files page"})]}):t.jsxs(t.Fragment,{children:[!i&&t.jsx(Ce,{type:"info",message:"No script selected",description:"Create or select a SQL script to register files",style:{marginBottom:16},showIcon:!0}),t.jsx(E,{style:{marginBottom:16,width:"100%",justifyContent:"space-between"},children:t.jsxs(D,{type:"primary",icon:t.jsx(ge,{}),onClick:C,disabled:r.length===0||!i,loading:g,children:["Register Selected (",r.length,")"]})}),t.jsx(K,{size:"small",dataSource:d,renderItem:l=>{const u=p(l),y=f(l.id);return t.jsx(K.Item,{actions:[t.jsx(He,{title:"Delete file?",description:"This will also delete associated queries and results.",onConfirm:()=>w(l.id),okText:"Delete",okType:"danger",children:t.jsx(D,{size:"small",icon:t.jsx(Ne,{}),danger:!0})},"delete")],children:t.jsx(K.Item.Meta,{avatar:t.jsx(Ct,{checked:r.includes(l.id),onChange:()=>S(l.id)}),title:t.jsxs(E,{children:[t.jsx(U,{children:l.name}),y&&t.jsx(V,{color:"blue",style:{fontSize:11},children:"In Script"}),u&&t.jsx(de,{title:"Registered in DuckDB",children:t.jsx(Se,{style:{color:"#52c41a"}})})]}),description:t.jsxs(E,{size:"small",children:[t.jsx(U,{type:"secondary",style:{fontSize:12},children:ht(l.size)}),t.jsx(U,{type:"secondary",style:{fontSize:12},children:"â€¢"}),t.jsx(U,{type:"secondary",style:{fontSize:12},children:new Date(l.uploadedAt).toLocaleDateString()})]})})})}})]})})},ss=({scripts:r,currentScript:e,scriptLoading:s,onSelectScript:n,onCreateScript:i,onRenameScript:a,onDeleteScript:h,selectedFileIds:c,onFileSelect:d,registeredTables:m,onRegisterFiles:g})=>t.jsxs(E,{orientation:"vertical",size:"large",style:{width:"100%"},children:[t.jsx(Ue,{scripts:r,currentScript:e,loading:s,onSelectScript:n,onCreateScript:i,onRenameScript:a,onDeleteScript:h}),t.jsx(ts,{selectedFileIds:c,onFileSelect:d,registeredTables:m,onRegisterFiles:g,currentScript:e})]}),{Text:rs}=J,as=({registeredTables:r,token:e})=>r.length===0?t.jsx(Ce,{type:"info",message:"No tables registered",description:"Select and register Parquet files to query them",style:{marginBottom:12},showIcon:!0}):t.jsx("div",{style:{marginBottom:12,padding:12,background:e.colorBgContainer,borderRadius:4,border:`1px solid ${e.colorBorder}`},children:t.jsxs(E,{size:"small",wrap:!0,children:[t.jsx(ge,{style:{color:e.colorPrimary}}),t.jsx(rs,{strong:!0,children:"Registered Tables:"}),r.map(s=>t.jsx(V,{color:"blue",children:s},s))]})}),{Text:ns,Paragraph:$e}=J,is=({tableNames:r,onInsertTemplate:e})=>{const n=(()=>{if(r.length===0)return[{title:"Getting Started",description:"Select one or more Parquet files from the file list to start querying.",sql:`-- No tables registered yet
-- Upload and register Parquet files to get started`}];const i=r[0],a=[{title:"Preview Table",description:"View the first 100 rows of a table",sql:`SELECT * FROM ${i} LIMIT 100;`},{title:"Count Rows",description:"Count total number of rows",sql:`SELECT COUNT(*) as row_count FROM ${i};`},{title:"Table Schema",description:"View column names and types",sql:`DESCRIBE ${i};`},{title:"Distinct Values",description:"Count unique values in a column",sql:`SELECT column_name, COUNT(DISTINCT column_name) as unique_count
FROM ${i}
GROUP BY column_name;`},{title:"Filter Data",description:"Filter rows using WHERE clause",sql:`SELECT *
FROM ${i}
WHERE column_name = 'value'
LIMIT 100;`},{title:"Aggregate by Group",description:"Group and aggregate data",sql:`SELECT
  category_column,
  COUNT(*) as count,
  AVG(numeric_column) as average
FROM ${i}
GROUP BY category_column
ORDER BY count DESC;`}];return r.length>=2&&a.push({title:"Join Tables",description:"Combine data from multiple tables",sql:`SELECT
  t1.*,
  t2.*
FROM ${r[0]} t1
JOIN ${r[1]} t2 ON t1.id = t2.id
LIMIT 100;`}),a.push({title:"Window Function",description:"Calculate row numbers and rankings",sql:`SELECT
  *,
  ROW_NUMBER() OVER (PARTITION BY category ORDER BY value DESC) as row_num
FROM ${i};`}),a})();return t.jsx(Y,{size:"small",title:t.jsxs(t.Fragment,{children:[t.jsx(Fe,{style:{marginRight:8}}),"Query Templates"]}),style:{marginTop:16},children:t.jsx(K,{size:"small",dataSource:n,renderItem:i=>t.jsx(K.Item,{actions:[t.jsx(D,{size:"small",icon:t.jsx(zt,{}),onClick:()=>e(i.sql),children:"Insert"})],children:t.jsx(K.Item.Meta,{title:t.jsx(ns,{strong:!0,children:i.title}),description:t.jsxs(t.Fragment,{children:[t.jsx($e,{style:{margin:0,marginBottom:8},children:i.description}),t.jsx($e,{code:!0,copyable:!0,style:{margin:0,whiteSpace:"pre-wrap",fontSize:12},children:i.sql})]})})})})})},{Text:ce}=J,os=({query:r,onQueryChange:e,isDirty:s,isSaving:n,onExecute:i,onSave:a,onReset:h,isExecuting:c,canExecute:d,result:m,isLoadingResults:g,tableNames:x,onInsertTemplate:S,registeredTables:w,theme:C,token:p,currentScriptId:f})=>{const[l,u]=o.useState("editor"),y=Array.isArray(m==null?void 0:m.result)?m.result:[],T=y.length,k=[{key:"editor",label:t.jsxs("span",{children:[t.jsx(vt,{})," SQL Editor"]}),children:t.jsxs(t.Fragment,{children:[t.jsx(as,{registeredTables:w,token:p}),t.jsx(bt,{height:"70vh",language:"sql",theme:C==="dark"?"vs-dark":"vs-light",value:r,onChange:I=>e(I||""),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on",suggest:{showKeywords:!0,showSnippets:!0},quickSuggestions:{other:!0,comments:!1,strings:!1},parameterHints:{enabled:!0},suggestOnTriggerCharacters:!0,acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",snippetSuggestions:"top"}})]})},{key:"templates",label:t.jsxs("span",{children:[t.jsx(Fe,{})," Templates"]}),children:t.jsx(is,{tableNames:x,onInsertTemplate:S})},{key:"results",label:t.jsx(jt,{count:(m==null?void 0:m.status)==="success"?T:0,showZero:!1,overflowCount:999,children:t.jsxs("span",{style:{marginRight:8},children:[t.jsx(St,{})," Results"]})}),children:P()}];function P(){var I;return g?t.jsx(ue,{description:"Loading results..."}):m?m.status==="error"?t.jsx("div",{style:{padding:24},children:t.jsxs(E,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[t.jsxs(E,{children:[t.jsx(V,{icon:t.jsx(Qe,{}),color:"error",children:"Error"}),t.jsx(ce,{type:"danger",children:"Query execution failed"})]}),t.jsx(ce,{type:"secondary",style:{fontSize:12},children:m.errorMessage})]})}):t.jsx("div",{style:{padding:"12px 0"},children:t.jsxs(E,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[t.jsxs(E,{size:"large",children:[t.jsx(E,{size:"small",children:t.jsx(V,{icon:t.jsx(Se,{}),color:"success",children:"Success"})}),t.jsxs(E,{size:"small",children:[t.jsx(_t,{}),t.jsxs(ce,{type:"secondary",style:{fontSize:12},children:[(I=m.executionTime)==null?void 0:I.toFixed(2),"ms"]})]}),t.jsx(E,{size:"small",children:t.jsxs(ce,{type:"secondary",style:{fontSize:12},children:[T," ",T===1?"row":"rows"]})})]}),y.length>0?t.jsx(Rt,{tableData:y,fileId:f,theme:C,token:p}):t.jsx(ue,{description:"Query returned no rows"})]})}):t.jsx(ue,{description:"No results yet. Execute a query to see results."})}return t.jsx(Y,{size:"small",title:"SQL Query",extra:t.jsxs(E,{wrap:!0,children:[t.jsx(D,{type:"primary",icon:t.jsx(Et,{}),onClick:i,disabled:!d||c,loading:c,children:"Run Query"}),t.jsx(D,{icon:t.jsx(Tt,{}),onClick:a,disabled:!s||c,loading:n,children:"Save Query"}),t.jsx(D,{icon:t.jsx(Pt,{}),onClick:h,disabled:c,danger:!0,children:"Reset"}),s?t.jsx(V,{color:"orange",children:"Unsaved Changes (auto-saving...)"}):t.jsx(V,{color:"green",children:"Saved"})]}),children:t.jsx(yt,{activeKey:l,onChange:u,items:k})})},js=()=>{const{theme:r}=gt(),{token:e}=mt.useToken(),[s,n]=o.useState([]),[i,a]=o.useState(new Map),{scripts:h,currentScript:c,loading:d,createScript:m,selectScript:g,renameScript:x,deleteScript:S}=Xt(),{status:w,tables:C,error:p,progressMessage:f,initialize:l,registerFileForScript:u,executeQuery:y,listTables:T}=Yt(),k=s.map(j=>i.get(j)||"").filter(Boolean),{query:P,isDirty:I,isSaving:Z,error:B,updateQuery:N,saveQuery:ee,resetQuery:te}=Kt(c,k),{selectedResult:se,isLoading:G,error:M,loadResults:A,saveResult:q}=Jt();o.useEffect(()=>{l()},[l]),o.useEffect(()=>{c&&A(c.id)},[c,A]),o.useEffect(()=>{(async()=>{n(c?c.fileIds:[])})()},[c]),o.useEffect(()=>{p&&R.error(p),B&&R.error(B),M&&R.error(M)},[p,B,M]);const _=o.useCallback(async j=>{if(!c){R.warning("Please create or select a script first");return}const O=new Map(i),ae=[...c.registeredTables||[]],H=[...c.fileIds||[]];for(const L of j)try{const v=await u(L);O.set(L.id,v),ae.includes(v)||ae.push(v),H.includes(L.id)||H.push(L.id),R.success(`Registered ${L.name} for script`)}catch(v){throw R.error(`Failed to register ${L.name}`),v}await F.updateFileIds(c.id,H),await F.updateRegisteredTables(c.id,ae),a(O),n(H),await T()},[c,u,i,T]),re=o.useCallback(async()=>{if(!P.trim()){R.warning("Please enter a SQL query");return}if(!c){R.warning("Please create or select a script first");return}try{const j=await y(P);await q(c.id,P,j.data,j.executionTime,"success"),R.success("Query executed successfully")}catch(j){const O=j instanceof Error?j.message:"Query execution failed";await q(c.id,P,null,0,"error",O),R.error(O)}},[P,c,y,q]),$=o.useCallback(j=>{N(j),R.success("Template inserted")},[N]);return t.jsxs(E,{orientation:"vertical",size:"large",style:{width:"100%",padding:24},children:[t.jsx(Zt,{status:w,message:f,tableCount:C.length}),t.jsx(es,{status:w,progressMessage:f,children:t.jsxs(E,{orientation:"vertical",size:"large",style:{width:"100%",padding:24},children:[t.jsx(ss,{scripts:h,currentScript:c,scriptLoading:d,onSelectScript:g,onCreateScript:m,onRenameScript:x,onDeleteScript:S,selectedFileIds:s,onFileSelect:n,registeredTables:C,onRegisterFiles:_}),t.jsx(os,{query:P,onQueryChange:N,isDirty:I,isSaving:Z,onExecute:re,onSave:ee,onReset:te,isExecuting:w==="executing",canExecute:w==="ready"&&c!==null&&s.length>0,result:se,isLoadingResults:G,tableNames:k,onInsertTemplate:$,registeredTables:C,theme:r,token:e,currentScriptId:c?c.id:null})]})})]})};export{js as default};
