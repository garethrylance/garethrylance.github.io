import{b as g,u as Pe,e as Le,g as Ae,H as $e,f as De,h as q,N as ie,R as Be}from"./react-vendor-DZ7cWdbH.js";import{L as ye,T as v,S as j,R as we,M as Oe,a as qe,b as Me,U as X,c as ze,d as Ne,B as re,e as _e,f as je,A as B,D as F,g as Ue,h as le,i as Ge,j as V,k as Ve,l as be,m as Ce,C as Se,n as S,F as Z,o as He,P as We,p as Je,s as ce,q as M,r as z,t as G,u as Ke,v as Ye,w as Xe,x as Ze,y as Qe,z as et}from"./antd-vendor-DcUuq7o0.js";import{p as tt,a as rt,b as ke,c as ve}from"./parquet-vendor-Dl19bzIY.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();var H={exports:{}},$={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var de;function nt(){if(de)return $;de=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function s(n,a,o){var i=null;if(o!==void 0&&(i=""+o),a.key!==void 0&&(i=""+a.key),"key"in a){o={};for(var l in a)l!=="key"&&(o[l]=a[l])}else o=a;return a=o.ref,{$$typeof:e,type:n,key:i,ref:a!==void 0?a:null,props:o}}return $.Fragment=r,$.jsx=s,$.jsxs=s,$}var ue;function ot(){return ue||(ue=1,H.exports=nt()),H.exports}var t=ot();const Te=g.createContext(void 0),W="parquet-viewer-theme";function st({children:e}){const[r,s]=g.useState(()=>{const o=localStorage.getItem(W);return o==="light"||o==="dark"?o:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),n=o=>{s(o),localStorage.setItem(W,o)};g.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),i=l=>{localStorage.getItem(W)||s(l.matches?"dark":"light")};return o.addEventListener("change",i),()=>o.removeEventListener("change",i)},[]),g.useEffect(()=>{r==="dark"?document.body.classList.add("dark"):document.body.classList.remove("dark")},[r]);const a={mode:r,setMode:n};return t.jsx(Te.Provider,{value:a,children:e})}function ne(){const e=g.useContext(Te);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e}const{Header:at,Content:it}=ye,{Title:lt}=v;function ct({children:e}){const r=Pe(),s=Le(),{mode:n}=ne(),a=s.pathname.replace("#","").split("/")[1]||"viewer",o=[{key:"viewer",icon:t.jsx(qe,{}),label:"Parquet Viewer",onClick:()=>r("/viewer")},{key:"settings",icon:t.jsx(Me,{}),label:"Settings",onClick:()=>r("/settings")}];return t.jsxs(ye,{style:{minHeight:"100vh"},children:[t.jsxs(at,{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 24px",background:n==="dark"?"#141414":"#fff",borderBottom:`1px solid ${n==="dark"?"#303030":"#f0f0f0"}`},children:[t.jsxs(j,{children:[t.jsx(we,{style:{fontSize:"24px",color:"#1890ff"}}),t.jsx(lt,{level:4,style:{margin:0,color:n==="dark"?"#fff":"#000"},children:"Parquet Viewer"})]}),t.jsx(Oe,{mode:"horizontal",selectedKeys:[a],items:o,style:{flex:1,minWidth:0,justifyContent:"flex-end",border:"none",background:"transparent"}})]}),t.jsx(it,{style:{padding:"24px",minHeight:"calc(100vh - 64px)",background:n==="dark"?"#000":"#f0f2f5"},children:t.jsx("div",{style:{maxWidth:"1600px",margin:"0 auto",background:n==="dark"?"#141414":"#fff",padding:"24px",borderRadius:"8px",minHeight:"calc(100vh - 112px)"},children:e})})]})}const w=[];for(let e=0;e<256;++e)w.push((e+256).toString(16).slice(1));function dt(e,r=0){return(w[e[r+0]]+w[e[r+1]]+w[e[r+2]]+w[e[r+3]]+"-"+w[e[r+4]]+w[e[r+5]]+"-"+w[e[r+6]]+w[e[r+7]]+"-"+w[e[r+8]]+w[e[r+9]]+"-"+w[e[r+10]]+w[e[r+11]]+w[e[r+12]]+w[e[r+13]]+w[e[r+14]]+w[e[r+15]]).toLowerCase()}let J;const ut=new Uint8Array(16);function ht(){if(!J){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");J=crypto.getRandomValues.bind(crypto)}return J(ut)}const pt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),he={randomUUID:pt};function gt(e,r,s){var a;if(he.randomUUID&&!e)return he.randomUUID();e=e||{};const n=e.random??((a=e.rng)==null?void 0:a.call(e))??ht();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,dt(n)}async function oe(e){const r=await fetch(`/test-fixtures/${e}`);if(!r.ok)throw new Error(`Failed to fetch test fixture: ${e}`);return await r.arrayBuffer()}function se(e){return["small_test.parquet","multi_type_test.parquet","invalid_file.parquet"].includes(e)}const Re=1e4,mt=3;function xt(e,r=Re){const s=[];let n=0,a=0;for(let o=0;o<e.length;o++){const i=e[o]??0;if(i<=r)s.push({chunkId:a++,rowGroupIndex:o,rowGroupSize:i,rowGroupStartRow:0,rowGroupEndRow:i,globalStartRow:n,globalEndRow:n+i}),n+=i;else{let l=0;for(;l<i;){const c=Math.min(r,i-l);s.push({chunkId:a++,rowGroupIndex:o,rowGroupSize:i,rowGroupStartRow:l,rowGroupEndRow:l+c,globalStartRow:n,globalEndRow:n+c}),n+=c,l+=c}}}return{totalChunks:s.length,chunkSize:r,chunks:s}}function Ie(e,r,s){const n=(e-1)*r,a=n+r,o=[];for(const i of s.chunks)i.globalEndRow>n&&i.globalStartRow<a&&o.push(i.chunkId);return o}function Ee(e,r){return r.chunks.find(s=>s.chunkId===e)}function ft(e,r,s,n){const a=(e-1)*r,o=a+r,l=Ie(e,r,n).map(u=>{const d=Ee(u,n),h=s[u];return d&&h?{metadata:d,chunk:h}:null}).filter(u=>u!==null).sort((u,d)=>u.metadata.globalStartRow-d.metadata.globalStartRow),c=[];for(const{metadata:u,chunk:d}of l){const h=u.globalStartRow,p=Math.max(0,a-h),f=Math.min(d.rows.length,o-h);for(let x=p;x<f;x++){const m=d.rows[x];if(m){const y=h+x;c.push({...m,__rowIndex:y})}}}return c}function yt(e,r,s=mt){const n=new Set(r),a=Object.entries(e).map(([d,h])=>({id:Number(d),chunk:h})).filter(d=>d.chunk!==void 0);if(a.length<=s)return e;const o=a.filter(d=>n.has(d.id)),i=a.filter(d=>!n.has(d.id));i.sort((d,h)=>d.chunk.lastAccessTime-h.chunk.lastAccessTime);const l=s-o.length,c=i.slice(-l),u={};for(const d of[...o,...c])u[d.id]=d.chunk;return u}function L(e){return{byteLength:e.size,slice(r,s){return e.slice(r,s).arrayBuffer()}}}async function wt(e){const r=ae(e);if(!r.valid)throw new Error(r.error||"Invalid Parquet file");try{let s;if(se(e.name))try{const u=await oe(e.name);s={byteLength:u.byteLength,slice(d,h){return u.slice(d,h)}}}catch{s=L(e)}else s=L(e);const n=await tt(s),a=rt(n),o=a.children?St(a.children):[],i=n.row_groups.map(u=>Number(u.num_rows)),l=i.reduce((u,d)=>u+d,0),c=xt(i);return{id:gt(),name:e.name,size:e.size,loadedAt:new Date,metadata:kt(n),rawMetadata:n,columns:o,rowCount:l,rowGroupCount:n.row_groups.length,rowsPerGroup:i,chunkIndex:c,fileHandle:e}}catch(s){throw{message:`Failed to parse Parquet file: ${s instanceof Error?s.message:"Unknown error"}`,...s instanceof Error&&{originalError:s},fileName:e.name}}}async function jt(e,r,s,n){if(r<0||r>=n.length)throw new Error(`Invalid row group index: ${r}`);if(n[r]===void 0||n[r]<0)throw new Error(`Invalid row count for group ${r}`);try{let a;if(se(e.name))try{const c=await oe(e.name);a={byteLength:c.byteLength,slice(u,d){return c.slice(u,d)}}}catch{a=L(e)}else a=L(e);let o=0;for(let c=0;c<r;c++)o+=n[c]??0;const i=o+(n[r]??0);let l=[];return await ke({file:a,metadata:s,rowStart:o,rowEnd:i,compressors:ve,rowFormat:"object",onComplete:c=>{l=c}}),l}catch(a){throw{message:`Failed to load row group ${r}: ${a instanceof Error?a.message:"Unknown error"}`,...a instanceof Error&&{originalError:a},fileName:e.name}}}async function bt(e,r,s){try{let n;if(se(e.name))try{const l=await oe(e.name);n={byteLength:l.byteLength,slice(c,u){return l.slice(c,u)}}}catch{n=L(e)}else n=L(e);const a=r.globalStartRow,o=r.globalEndRow;let i=[];return await ke({file:n,metadata:s,rowStart:a,rowEnd:o,compressors:ve,rowFormat:"object",onComplete:l=>{i=l}}),{chunkId:r.chunkId,rowGroupIndex:r.rowGroupIndex,startRow:r.globalStartRow,endRow:r.globalEndRow,rows:i,lastAccessTime:Date.now()}}catch(n){throw{message:`Failed to load chunk ${r.chunkId}: ${n instanceof Error?n.message:"Unknown error"}`,...n instanceof Error&&{originalError:n},fileName:e.name}}}async function Ct(e,r,s,n){if((n[r.rowGroupIndex]??0)<=Re){const o=await jt(e,r.rowGroupIndex,s,n);return{chunkId:r.chunkId,rowGroupIndex:r.rowGroupIndex,startRow:r.globalStartRow,endRow:r.globalEndRow,rows:o,lastAccessTime:Date.now()}}else return bt(e,r,s)}function St(e){const r=[],s=(n,a=[])=>{const o=n.element,i=[...a,o.name],l=i.join(".");if(o.type){const c=o.logical_type?o.logical_type.type:o.converted_type;r.push({name:l,type:o.type,nullable:o.repetition_type==="OPTIONAL",...c&&{logicalType:c}})}n.children&&n.children.length>0&&n.children.forEach(c=>s(c,i))};return e.forEach(n=>s(n)),r}function kt(e){const r=vt(e.key_value_metadata);return{numRowGroups:e.row_groups.length,version:String(e.version),...e.created_by&&{createdBy:e.created_by},...r&&{keyValueMetadata:r}}}function vt(e){if(!e||e.length===0)return;const r={};for(const s of e)s.key&&s.value&&(r[s.key]=s.value);return Object.keys(r).length>0?r:void 0}function ae(e){return e.name.toLowerCase().endsWith(".parquet")?e.size<100?{valid:!1,error:"File is too small to be a valid Parquet file"}:{valid:!0}:{valid:!1,error:"File must have .parquet extension"}}function Tt(){const[e,r]=g.useState(null),[s,n]=g.useState(!1),[a,o]=g.useState(null),i=g.useCallback(async c=>{o(null);const u=ae(c);if(!u.valid){o({message:u.error??"Invalid Parquet file",fileName:c.name});return}n(!0);try{const d=await wt(c);r(d),o(null)}catch(d){Rt(d)?o(d):o({message:`Failed to load file: ${d instanceof Error?d.message:"Unknown error"}`,fileName:c.name}),r(null)}finally{n(!1)}},[]),l=g.useCallback(()=>{r(null),o(null),n(!1)},[]);return{file:e,loading:s,error:a,loadFile:i,clearFile:l}}function Rt(e){return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}function It(e,r=1e4){const s=[];return e.rowsPerGroup.forEach((n,a)=>{if(n>r){const o=n/e.rowCount*e.size;s.push({index:a,rows:n,sizeBytes:o})}}),s}function Et(e,r){const[s,n]=g.useState(!1),[a,o]=g.useState([]),[i,l]=g.useState(null),[c,u]=g.useState(null);return g.useEffect(()=>{if(!e){n(!1),o([]),l(null),u(null);return}const p=It(e);p.length>0?(o(p),l(e),n(!0)):u(e)},[e]),{showWarning:s,largeGroups:a,pendingFile:i,displayedFile:c,handleContinue:()=>{n(!1),u(i),l(null)},handleCancel:()=>{n(!1),l(null),o([]),r()}}}const{Dragger:Ft}=X,{Text:pe,Paragraph:Pt}=v;function Lt({mode:e,loading:r,onFileSelect:s,loadedButtonText:n}){const a=async i=>{const{file:l}=i,c=l.originFileObj||(l instanceof File?l:null);c&&await s(c)},o=i=>ae(i).valid?!1:X.LIST_IGNORE;return r?t.jsxs("div",{style:{textAlign:"center",padding:"48px"},role:"status","aria-live":"polite","aria-label":"Loading file",children:[t.jsx(ze,{size:"large"}),t.jsx(Pt,{style:{marginTop:"16px",color:"#999"},children:"Loading Parquet file metadata..."})]}):e==="initial"?t.jsx("div",{style:{padding:"24px"},children:t.jsxs(Ft,{name:"file",multiple:!1,accept:".parquet",beforeUpload:o,onChange:a,showUploadList:!1,style:{padding:"48px"},"data-testid":"file-upload-dragger","aria-label":"Upload Parquet file by clicking or dragging",children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(Ne,{style:{fontSize:"64px",color:"#1890ff"}})}),t.jsx("p",{className:"ant-upload-text",style:{fontSize:"18px"},children:"Click or drag Parquet file to this area"}),t.jsx("p",{className:"ant-upload-hint",style:{fontSize:"14px",color:"#999"},children:"Select a .parquet file to view its contents. The file will be processed locally in your browser - no data is uploaded to any server."}),t.jsxs("div",{style:{marginTop:"24px"},children:[t.jsx(pe,{type:"secondary",children:"Supported: Apache Parquet (.parquet)"}),t.jsx("br",{}),t.jsx(pe,{type:"secondary",children:"Max recommended size: 500MB"})]})]})}):t.jsx("div",{style:{marginBottom:"16px",textAlign:"right"},children:t.jsx(X,{name:"file",multiple:!1,accept:".parquet",beforeUpload:o,onChange:a,showUploadList:!1,children:t.jsx(re,{icon:t.jsx(_e,{}),"aria-label":"Load a different Parquet file",children:n||"Load Different File"})})})}const{Text:N,Paragraph:ge}=v;function At({visible:e,error:r,onClose:s}){return r?t.jsxs(je,{title:t.jsxs("span",{children:[t.jsx(Ue,{style:{color:"#ff4d4f",marginRight:"8px"},"aria-hidden":"true"}),"Failed to Load Parquet File"]}),open:e,onCancel:s,onOk:s,cancelButtonProps:{style:{display:"none"}},okText:"Close","aria-labelledby":"error-modal-title","aria-describedby":"error-modal-description",children:[t.jsx(B,{message:"Error Loading File",description:r.message,type:"error",showIcon:!0,style:{marginBottom:"16px"}}),r.fileName&&t.jsxs(t.Fragment,{children:[t.jsx(F,{}),t.jsxs("div",{children:[t.jsx(N,{strong:!0,children:"File Name:"}),t.jsx("br",{}),t.jsx(N,{code:!0,children:r.fileName})]})]}),r.originalError&&t.jsxs(t.Fragment,{children:[t.jsx(F,{}),t.jsxs("div",{children:[t.jsx(N,{strong:!0,children:"Technical Details:"}),t.jsx(ge,{style:{marginTop:"8px"},children:t.jsx(N,{type:"secondary",style:{fontSize:"12px",fontFamily:"monospace"},children:r.originalError.message})})]})]}),t.jsx(F,{}),t.jsx(ge,{type:"secondary",style:{fontSize:"12px",marginBottom:0},children:"Please ensure the file is a valid Parquet file and try again."})]}):null}function $t(e){if(e==null)return"null";if(e instanceof Date)return e.toISOString();if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return Number.isInteger(e)?e.toLocaleString():e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6});if(typeof e=="bigint")return e.toString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[Object]"}return String(e)}function Dt(e){return typeof e=="number"||typeof e=="bigint"}function Bt(e){return typeof e=="boolean"}function Ot(e){return e==null}function qt(e,r=100){return e.length<=r?e:e.slice(0,r)+"..."}function Mt(e,r=100){return e.length>r}function Q(e){if(e===0)return"0 B";const r=["B","KB","MB","GB","TB"],s=1024,n=Math.floor(Math.log(e)/Math.log(s));return`${(e/Math.pow(s,n)).toFixed(2)} ${r[n]}`}function zt(e,r){if(r)switch(r){case"UTF8":case"STRING":return"String";case"TIMESTAMP_MILLIS":case"TIMESTAMP_MICROS":return"Timestamp";case"DATE":return"Date";case"DECIMAL":return"Decimal";case"JSON":return"JSON";case"BSON":return"BSON";case"UUID":return"UUID";default:return r}switch(e){case"BOOLEAN":return"Boolean";case"INT32":return"Int32";case"INT64":return"Int64";case"FLOAT":return"Float";case"DOUBLE":return"Double";case"BYTE_ARRAY":return"ByteArray";case"FIXED_LEN_BYTE_ARRAY":return"FixedByteArray";default:return e}}const{Text:b,Paragraph:Nt}=v;function _t({visible:e,file:r,largeGroups:s,onContinue:n,onCancel:a}){return!r||s.length===0?null:t.jsxs(je,{title:t.jsxs("span",{children:[t.jsx(Ge,{style:{color:"#1890ff",marginRight:"8px"}}),"Large Row Groups Detected"]}),open:e,onCancel:a,onOk:n,okText:"Continue",cancelText:"Cancel",width:600,children:[t.jsx(B,{title:"This file contains large row groups",description:"These row groups will be automatically split into 10,000-row chunks and loaded on-demand for efficient memory usage.",type:"info",showIcon:!0,style:{marginBottom:"16px"}}),t.jsxs(j,{orientation:"vertical",style:{width:"100%"},size:"middle",children:[t.jsxs("div",{children:[t.jsx(b,{strong:!0,children:"File:"})," ",t.jsx(b,{code:!0,children:r.name}),t.jsx("br",{}),t.jsx(b,{strong:!0,children:"Total Size:"})," ",t.jsx(b,{children:Q(r.size)}),t.jsx("br",{}),t.jsx(b,{strong:!0,children:"Total Rows:"})," ",t.jsx(b,{children:r.rowCount.toLocaleString()}),t.jsx("br",{}),t.jsx(b,{strong:!0,children:"Row Groups:"})," ",t.jsx(b,{children:r.rowGroupCount})]}),t.jsxs("div",{children:[t.jsxs(b,{strong:!0,children:["Large Row Groups (",s.length,"):"]}),t.jsx(le,{size:"small",bordered:!0,dataSource:s,style:{marginTop:"8px"},renderItem:o=>t.jsx(le.Item,{children:t.jsxs(j,{style:{width:"100%",justifyContent:"space-between"},children:[t.jsxs("span",{children:[t.jsxs(b,{strong:!0,children:["Group ",o.index]}),t.jsxs(b,{type:"secondary",children:[" (",o.rows.toLocaleString()," rows)"]})]}),t.jsxs(b,{type:"warning",strong:!0,children:["~",Q(o.sizeBytes)]})]})})})]}),t.jsx("div",{children:t.jsxs(Nt,{type:"secondary",style:{fontSize:"12px",marginBottom:0},children:[t.jsx("strong",{children:"How streaming works:"}),t.jsxs("ul",{style:{marginTop:"4px",paddingLeft:"20px"},children:[t.jsx("li",{children:"Row groups larger than 10,000 rows are split into chunks"}),t.jsx("li",{children:"Only the chunks needed for the current page are loaded"}),t.jsx("li",{children:"Memory usage is bounded regardless of file size"}),t.jsx("li",{children:"Older chunks are automatically evicted to maintain a 30,000-row cache"})]})]})})]})]})}var K,me;function Ut(){return me||(me=1,K=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var r=document.activeElement,s=[],n=0;n<e.rangeCount;n++)s.push(e.getRangeAt(n));switch(r.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":r.blur();break;default:r=null;break}return e.removeAllRanges(),function(){e.type==="Caret"&&e.removeAllRanges(),e.rangeCount||s.forEach(function(a){e.addRange(a)}),r&&r.focus()}}),K}var Y,xe;function Gt(){if(xe)return Y;xe=1;var e=Ut(),r={"text/plain":"Text","text/html":"Url",default:"Text"},s="Copy to clipboard: #{key}, Enter";function n(o){var i=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return o.replace(/#{\s*key\s*}/g,i)}function a(o,i){var l,c,u,d,h,p,f=!1;i||(i={}),l=i.debug||!1;try{u=e(),d=document.createRange(),h=document.getSelection(),p=document.createElement("span"),p.textContent=o,p.ariaHidden="true",p.style.all="unset",p.style.position="fixed",p.style.top=0,p.style.clip="rect(0, 0, 0, 0)",p.style.whiteSpace="pre",p.style.webkitUserSelect="text",p.style.MozUserSelect="text",p.style.msUserSelect="text",p.style.userSelect="text",p.addEventListener("copy",function(m){if(m.stopPropagation(),i.format)if(m.preventDefault(),typeof m.clipboardData>"u"){l&&console.warn("unable to use e.clipboardData"),l&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var y=r[i.format]||r.default;window.clipboardData.setData(y,o)}else m.clipboardData.clearData(),m.clipboardData.setData(i.format,o);i.onCopy&&(m.preventDefault(),i.onCopy(m.clipboardData))}),document.body.appendChild(p),d.selectNodeContents(p),h.addRange(d);var x=document.execCommand("copy");if(!x)throw new Error("copy command was unsuccessful");f=!0}catch(m){l&&console.error("unable to copy using execCommand: ",m),l&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(i.format||"text",o),i.onCopy&&i.onCopy(window.clipboardData),f=!0}catch(y){l&&console.error("unable to copy using clipboardData: ",y),l&&console.error("falling back to prompt"),c=n("message"in i?i.message:s),window.prompt(c,o)}}finally{h&&(typeof h.removeRange=="function"?h.removeRange(d):h.removeAllRanges()),p&&document.body.removeChild(p),u()}return f}return Y=a,Y}var Vt=Gt();const Fe=Ae(Vt),{Text:C}=v;function Ht(e){try{const r=JSON.parse(e);if(r!==null&&typeof r=="object")return r}catch{}return null}const ee=(e,r="root",s="",n=0,a=10,o)=>{const i=s?`${s}.${r}`:String(r);if(n>a)return{key:i,title:t.jsxs("span",{children:[t.jsxs(C,{type:"secondary",children:[r,": "]}),t.jsx(C,{type:"warning",children:"[Maximum depth reached]"})]}),isLeaf:!0};if(e==null)return{key:i,title:t.jsxs("span",{children:[t.jsxs(C,{type:"secondary",children:[r,": "]}),t.jsx(C,{type:"secondary",children:String(e)})]}),isLeaf:!0};if(typeof e!="object"){const f=typeof e=="string"?`"${e}"`:String(e);return{key:i,title:t.jsxs("span",{children:[t.jsxs(C,{type:"secondary",children:[r,": "]}),t.jsx(C,{style:{color:typeof e=="number"?o.colorWarning:typeof e=="boolean"?o.colorInfo:o.colorSuccess},children:f})]}),isLeaf:!0}}if(Array.isArray(e)){const x=Math.min(e.length,100),m=e.length>100,y=e.slice(0,x).map((I,E)=>ee(I,`[${E}]`,i,n+1,a,o));m&&y.push({key:`${i}.$more`,title:t.jsxs(C,{type:"warning",children:["... ",e.length-100," more items (showing first ",100,")"]}),isLeaf:!0});const A={key:i,title:t.jsxs("span",{children:[t.jsxs(C,{type:"secondary",children:[r,": "]}),t.jsxs(C,{strong:!0,children:["Array(",e.length,")"]})]}),isLeaf:y.length===0};return y.length>0&&(A.children=y),A}const l=Object.entries(e),c=100,u=Math.min(l.length,c),d=l.length>c,h=l.slice(0,u).map(([f,x])=>ee(x,f,i,n+1,a,o));d&&h.push({key:`${i}.$more`,title:t.jsxs(C,{type:"warning",children:["... ",l.length-c," more properties (showing first ",c,")"]}),isLeaf:!0});const p={key:i,title:t.jsxs("span",{children:[t.jsxs(C,{type:"secondary",children:[r,": "]}),t.jsxs(C,{strong:!0,children:["Object(",l.length,")"]})]}),isLeaf:h.length===0};return h.length>0&&(p.children=h),p};function Wt({metadata:e}){const{token:r}=V.useToken(),s=g.useMemo(()=>{if(!e||Object.keys(e).length===0)return[];const n={};for(const[a,o]of Object.entries(e)){const i=Ht(o);i!==null?n[a]=i:n[a]=o}return Object.entries(n).map(([a,o])=>ee(o,a,"",0,10,r))},[e,r]);return!e||Object.keys(e).length===0?t.jsx("span",{style:{color:"#8c8c8c",fontStyle:"italic"},children:"No custom metadata"}):t.jsx("div",{style:{padding:"8px",borderRadius:"4px",backgroundColor:r.colorBgContainer,border:`1px solid ${r.colorBorder}`,maxHeight:"400px",overflow:"auto"},children:t.jsx(Ve,{showLine:!0,defaultExpandAll:!0,treeData:s,blockNode:!0,style:{backgroundColor:"transparent"}})})}const{Text:_}=v,{useApp:Jt}=be;function Kt({file:e,defaultExpanded:r=!0}){const[s,n]=g.useState(r?["1","2","3"]:[]),{message:a}=Jt(),o=()=>{const l={fileName:e.name,fileSize:e.size,rowCount:e.rowCount,rowGroupCount:e.rowGroupCount,rowsPerGroup:e.rowsPerGroup,columns:e.columns,metadata:e.metadata,loadedAt:e.loadedAt.toISOString()};Fe(JSON.stringify(l,null,2))?a.success("Metadata copied to clipboard"):a.error("Failed to copy metadata")},i=[{title:"Column Name",dataIndex:"name",key:"name",render:l=>t.jsx(_,{code:!0,children:l})},{title:"Type",dataIndex:"type",key:"type",render:(l,c)=>t.jsx(_,{style:{color:"#1890ff"},children:zt(l,c.logicalType)})},{title:"Nullable",dataIndex:"nullable",key:"nullable",render:l=>l?"Yes":"No"}];return t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsxs(j,{style:{marginBottom:"8px",width:"100%",justifyContent:"space-between"},children:[t.jsxs(j,{children:[t.jsx(we,{}),t.jsx(_,{strong:!0,children:"File Information"})]}),t.jsx(re,{size:"small",icon:t.jsx(Ce,{}),onClick:o,children:"Copy Metadata as JSON"})]}),t.jsx(Se,{activeKey:s,onChange:l=>n(l),accordion:!1,items:[{key:"1",label:"Basic Information",children:t.jsxs(S,{column:1,size:"small",bordered:!0,children:[t.jsx(S.Item,{label:"File Name",children:e.name}),t.jsx(S.Item,{label:"File Size",children:Q(e.size)}),t.jsx(S.Item,{label:"Total Rows",children:e.rowCount.toLocaleString()}),t.jsx(S.Item,{label:"Row Groups",children:e.rowGroupCount}),t.jsx(S.Item,{label:"Loaded At",children:e.loadedAt.toLocaleString()})]})},{key:"2",label:`Schema (${e.columns.length} columns)`,children:t.jsx(Z,{dataSource:e.columns,columns:i,rowKey:"name",size:"small",pagination:!1,scroll:{y:300}})},{key:"3",label:"File Metadata",children:t.jsxs(t.Fragment,{children:[t.jsxs(S,{column:1,size:"small",bordered:!0,children:[t.jsx(S.Item,{label:"Parquet Version",children:e.metadata.version}),t.jsx(S.Item,{label:"Created By",children:e.metadata.createdBy||"Unknown"}),t.jsx(S.Item,{label:"Row Groups",children:e.metadata.numRowGroups}),e.metadata.keyValueMetadata&&t.jsx(S.Item,{label:"Custom Metadata",children:t.jsx(Wt,{metadata:e.metadata.keyValueMetadata})})]}),t.jsxs("div",{style:{marginTop:"16px"},children:[t.jsx(_,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"Row Group Distribution:"}),t.jsx(Z,{dataSource:e.rowsPerGroup.map((l,c)=>({index:c,rows:l,percentage:(l/e.rowCount*100).toFixed(1)})),columns:[{title:"Group",dataIndex:"index",key:"index"},{title:"Rows",dataIndex:"rows",key:"rows",render:l=>l.toLocaleString()},{title:"Percentage",dataIndex:"percentage",key:"percentage",render:l=>`${l}%`}],size:"small",pagination:!1,scroll:{y:200},rowKey:"index"})]})]})}]})]})}function Yt(e){const[r,s]=g.useState({}),[n,a]=g.useState(!1),[o,i]=g.useState(1),[l,c]=g.useState(500);g.useEffect(()=>{s({}),i(1)},[e==null?void 0:e.id]);const u=g.useCallback(async(f,x)=>{if(!e)return;const m=x??l;a(!0);try{const y=Ie(f,m,e.chunkIndex),A=y.filter(I=>!r[I]);if(A.length>0){const I=A.map(async T=>{const k=Ee(T,e.chunkIndex);if(!k)throw new Error(`Chunk metadata not found for chunk ${T}`);const P=await Ct(e.fileHandle,k,e.rawMetadata,e.rowsPerGroup);return{chunkId:T,chunk:P}}),E=await Promise.all(I);s(T=>{const k={...T};for(const{chunkId:P,chunk:O}of E)k[P]=O;for(const P of y){const O=k[P];O&&(k[P]={...O,lastAccessTime:Date.now()})}return yt(k,y)})}else s(I=>{const E={...I};for(const T of y){const k=E[T];k&&(E[T]={...k,lastAccessTime:Date.now()})}return E});i(f),x!==void 0&&c(x)}catch(y){throw console.error("Failed to load chunks:",y),y}finally{a(!1)}},[e,l,r]),d=g.useMemo(()=>e?ft(o,l,r,e.chunkIndex):[],[e,o,l,r]),h=g.useCallback(()=>{s({})},[]),p=g.useMemo(()=>{const f=Object.values(r).filter(x=>x!==void 0);return{chunkCount:f.length,totalRows:f.reduce((x,m)=>x+((m==null?void 0:m.rows.length)??0),0)}},[r]);return{currentPageRows:d,loading:n,currentPage:o,pageSize:l,changePage:u,clearCache:h,cacheStats:p}}function Xt({value:e,maxLength:r=100}){if(Ot(e))return t.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"null"});if(Bt(e))return t.jsx(He,{color:e?"green":"default",children:String(e)});const s=$t(e);return Dt(e)?t.jsx("div",{style:{textAlign:"right",fontFamily:"monospace"},children:s}):Mt(s,r)?t.jsx(Zt,{value:s,maxLength:r}):t.jsx("span",{children:s})}function Zt({value:e,maxLength:r}){const s=()=>{Fe(e)?ce.success("Copied to clipboard"):ce.error("Failed to copy")},n=t.jsxs("div",{style:{maxWidth:"400px",maxHeight:"300px",overflow:"auto"},children:[t.jsx("pre",{style:{margin:0,marginBottom:"8px",fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e}),t.jsx(re,{size:"small",icon:t.jsx(Ce,{}),onClick:s,block:!0,children:"Copy to Clipboard"})]});return t.jsx(We,{content:n,title:"Full Value",trigger:"click",placement:"topLeft",children:t.jsx(Je,{title:"Click to view full value",children:t.jsx("span",{style:{cursor:"pointer",color:"#1890ff",textDecoration:"underline",textDecorationStyle:"dotted"},children:qt(e,r)})})})}function Qt(e,r){return{title:r||e,dataIndex:e,key:e,render:s=>t.jsx(Xt,{value:s}),sorter:(s,n)=>{const a=s[e],o=n[e];return a==null?-1:o==null?1:typeof a=="number"&&typeof o=="number"?a-o:String(a).localeCompare(String(o))}}}const{Text:R}=v;function er({file:e,error:r}){const{currentPageRows:s,loading:n,currentPage:a,pageSize:o,changePage:i,clearCache:l}=Yt(e);g.useEffect(()=>{l(),i(1,500).catch(d=>{console.error("Failed to load first page:",d)})},[e.id]);const c=async(d,h)=>{try{await i(d,h)}catch(p){console.error("Failed to change page:",p)}},u=e.columns.map(d=>Qt(d.name,d.name));return r?t.jsx(B,{title:"Error Loading Data",description:r,type:"error",showIcon:!0}):!n&&s.length===0&&a===1?t.jsx(B,{title:"No Data",description:"This Parquet file appears to be empty or the first page could not be loaded.",type:"info",showIcon:!0}):t.jsxs("div",{children:[t.jsxs(j,{style:{marginBottom:"16px"},role:"status","aria-live":"polite",children:[t.jsxs(R,{children:[t.jsx(R,{strong:!0,children:"Showing rows:"})," ",((a-1)*o+1).toLocaleString()," -"," ",Math.min(a*o,e.rowCount).toLocaleString()," of ",e.rowCount.toLocaleString()]}),t.jsx(R,{type:"secondary","aria-hidden":"true",children:"|"}),t.jsxs(R,{children:[t.jsx(R,{strong:!0,children:"Columns:"})," ",e.columns.length]}),t.jsx(R,{type:"secondary","aria-hidden":"true",children:"|"}),t.jsxs(R,{children:[t.jsx(R,{strong:!0,children:"Row Groups:"})," ",e.rowGroupCount]})]}),t.jsx(Z,{columns:u,dataSource:s,rowKey:d=>`row-${d.__rowIndex}`,loading:n,"aria-label":`Parquet data table with ${e.rowCount} rows and ${e.columns.length} columns`,pagination:{current:a,pageSize:o,total:e.rowCount,showSizeChanger:!0,pageSizeOptions:["100","500","1000","2000"],showTotal:(d,h)=>`${h[0]}-${h[1]} of ${d} rows`,onChange:c,onShowSizeChange:c},scroll:{x:e.columns.length*150,y:600},virtual:!0,size:"small",bordered:!0,sticky:!0})]})}const{Title:tr,Paragraph:rr}=v;function nr(){const{file:e,loading:r,error:s,loadFile:n,clearFile:a}=Tt(),{showWarning:o,largeGroups:i,pendingFile:l,displayedFile:c,handleContinue:u,handleCancel:d}=Et(e,a),h=async x=>{try{await n(x)}catch(m){console.error("Error loading file:",m)}},p=()=>{a()},f=c?"loaded":"initial";return t.jsxs("main",{role:"main","aria-label":"Parquet File Viewer",children:[t.jsx("header",{children:t.jsxs(j,{orientation:"vertical",size:"small",style:{marginBottom:"24px",width:"100%"},children:[t.jsx(tr,{level:2,style:{margin:0},children:"Parquet File Viewer"}),t.jsx(rr,{type:"secondary",style:{margin:0},children:"Load and explore Parquet files directly in your browser. All processing happens locally - no data is uploaded to any server."})]})}),t.jsx(F,{}),t.jsx(Lt,{mode:f,loading:r,onFileSelect:h}),c&&t.jsxs(t.Fragment,{children:[t.jsx(F,{}),t.jsx(Kt,{file:c,defaultExpanded:!0}),t.jsx(F,{}),t.jsx(er,{file:c})]}),t.jsx(At,{visible:!!s&&!r,error:s,onClose:p}),t.jsx(_t,{visible:o,file:l,largeGroups:i,onContinue:u,onCancel:d})]})}const{Text:te}=v,U=({name:e,value:r})=>{const s=String(r),n=typeof r=="string"&&(s.startsWith("#")||s.startsWith("rgb")||s.startsWith("hsl"));return t.jsx("div",{style:{marginBottom:12},children:t.jsxs(j,{align:"start",style:{width:"100%"},children:[n&&t.jsx("div",{style:{width:40,height:40,backgroundColor:s,border:"1px solid #d9d9d9",borderRadius:4,flexShrink:0}}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx(te,{strong:!0,style:{display:"block"},children:e}),t.jsx(te,{type:"secondary",style:{fontSize:12,fontFamily:"monospace",display:"block",wordBreak:"break-all"},children:s})]})]})})},or=()=>{const{token:e}=V.useToken(),r={},s={},n={},a={};Object.entries(e).forEach(([i,l])=>{const c=i.toLowerCase();c.includes("color")||c.includes("bg")?r[i]=l:c.includes("size")||c.includes("width")||c.includes("height")||c.includes("margin")||c.includes("padding")||c.includes("radius")?s[i]=l:c.includes("font")||c.includes("line")||c.includes("text")?n[i]=l:a[i]=l});const o=[{key:"colors",label:`Colors & Backgrounds (${Object.keys(r).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(r).map(([i,l])=>t.jsx(z,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})},{key:"sizes",label:`Sizes & Spacing (${Object.keys(s).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(s).map(([i,l])=>t.jsx(z,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})},{key:"fonts",label:`Typography (${Object.keys(n).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(n).map(([i,l])=>t.jsx(z,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})},{key:"other",label:`Other Tokens (${Object.keys(a).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(a).map(([i,l])=>t.jsx(z,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})}];return t.jsx(G,{title:t.jsxs(j,{children:[t.jsx(Ke,{}),"Theme Tokens"]}),children:t.jsxs(j,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[t.jsx(te,{type:"secondary",children:"Explore all design tokens from the current Ant Design theme. These values are automatically generated based on your selected theme (light/dark) and can be used throughout the application."}),t.jsx(Se,{items:o,defaultActiveKey:[]})]})})},{Title:sr,Paragraph:fe,Text:D}=v;function ar(){const{mode:e,setMode:r}=ne(),s=n=>{r(n?"dark":"light")};return t.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[t.jsx(sr,{level:2,children:"Settings"}),t.jsx(fe,{children:"Customize your Parquet Viewer experience. Settings are automatically saved to your browser's local storage."}),t.jsx(G,{title:t.jsxs(j,{children:[e==="dark"?t.jsx(Xe,{}):t.jsx(Ze,{}),t.jsx("span",{children:"Appearance"})]}),style:{marginBottom:"24px"},children:t.jsxs(j,{orientation:"vertical",size:"large",style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx(D,{strong:!0,children:"Dark Mode"}),t.jsx("br",{}),t.jsx(D,{type:"secondary",children:"Toggle between light and dark theme"})]}),t.jsx(Ye,{checked:e==="dark",onChange:s})]}),t.jsx(F,{}),t.jsx(B,{title:"Theme Persistence",description:"Your theme preference is saved to browser local storage and will persist across sessions.",type:"info",showIcon:!0})]})}),t.jsxs(G,{title:"Theme Color Palette",style:{marginBottom:"24px"},children:[t.jsx(fe,{type:"secondary",style:{marginBottom:"24px"},children:"Current theme colors used throughout the application. These update automatically when you switch themes."}),t.jsx(or,{})]}),t.jsx(G,{title:"About",children:t.jsxs(j,{orientation:"vertical",children:[t.jsxs(D,{children:[t.jsx(D,{strong:!0,children:"Parquet Viewer"})," - Browser-based Parquet file viewer"]}),t.jsx(D,{type:"secondary",children:"View and explore Parquet files directly in your browser with on-demand row group loading for optimal performance."})]})})]})}function ir(){const{mode:e}=ne();return t.jsx(Qe,{theme:{algorithm:e==="dark"?V.darkAlgorithm:V.defaultAlgorithm},children:t.jsx(be,{children:t.jsx($e,{children:t.jsx(ct,{children:t.jsxs(De,{children:[t.jsx(q,{path:"/",element:t.jsx(ie,{to:"/viewer",replace:!0})}),t.jsx(q,{path:"/viewer",element:t.jsx(nr,{})}),t.jsx(q,{path:"/settings",element:t.jsx(ar,{})}),t.jsx(q,{path:"*",element:t.jsx(ie,{to:"/",replace:!0})})]})})})})})}function lr(){return t.jsx(st,{children:t.jsx(ir,{})})}et.createRoot(document.getElementById("root")).render(t.jsx(Be.StrictMode,{children:t.jsx(lr,{})}));
