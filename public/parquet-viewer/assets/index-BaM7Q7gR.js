import{b as p,u as De,e as $e,g as Be,H as Oe,f as ze,h as z,N as ce,R as Me}from"./react-vendor-DZ7cWdbH.js";import{L as be,T as v,a as B,S as w,R as Se,M as Ne,b as qe,c as _e,U as X,d as Ue,e as Ge,B as W,f as We,g as Ve,A as G,D as L,h as He,i as Je,j as Ce,C as oe,k as de,l as Ke,m as ke,n as ve,o as C,F as Z,p as Ye,P as Xe,q as Ze,s as ue,r as M,t as N,u as Q,v as Qe,w as he,x as et,y as tt,z as rt,E as nt,G as ot}from"./antd-vendor-DR6BUINE.js";import{p as st,a as at,b as Re,c as Te}from"./parquet-vendor-Dl19bzIY.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();var V={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge;function it(){if(ge)return D;ge=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function n(o,a,s){var i=null;if(s!==void 0&&(i=""+s),a.key!==void 0&&(i=""+a.key),"key"in a){s={};for(var l in a)l!=="key"&&(s[l]=a[l])}else s=a;return a=s.ref,{$$typeof:e,type:o,key:i,ref:a!==void 0?a:null,props:s}}return D.Fragment=r,D.jsx=n,D.jsxs=n,D}var pe;function lt(){return pe||(pe=1,V.exports=it()),V.exports}var t=lt();const Ee=p.createContext(void 0),H="parquet-viewer-theme";function ct({children:e}){const[r,n]=p.useState(()=>{const s=localStorage.getItem(H);return s==="light"||s==="dark"?s:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),o=s=>{n(s),localStorage.setItem(H,s)};p.useEffect(()=>{const s=window.matchMedia("(prefers-color-scheme: dark)"),i=l=>{localStorage.getItem(H)||n(l.matches?"dark":"light")};return s.addEventListener("change",i),()=>s.removeEventListener("change",i)},[]),p.useEffect(()=>{r==="dark"?document.body.classList.add("dark"):document.body.classList.remove("dark")},[r]);const a={mode:r,setMode:o};return t.jsx(Ee.Provider,{value:a,children:e})}function Ie(){const e=p.useContext(Ee);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e}const{Header:dt,Content:ut}=be,{Title:ht}=v;function gt({children:e}){const r=De(),n=$e(),{token:o}=B.useToken(),a=n.pathname.replace("#","").split("/")[1]||"viewer",s=[{key:"viewer",icon:t.jsx(qe,{}),label:"Parquet Viewer",onClick:()=>r("/viewer")},{key:"settings",icon:t.jsx(_e,{}),label:"Settings",onClick:()=>r("/settings")}];return t.jsxs(be,{style:{minHeight:"100vh"},children:[t.jsxs(dt,{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 24px",background:o.colorBgContainer,borderBottom:`1px solid ${o.colorBorderSecondary}`},children:[t.jsxs(w,{children:[t.jsx(Se,{style:{fontSize:"24px",color:o.colorPrimary}}),t.jsx(ht,{level:4,style:{margin:0,color:o.colorText},children:"Parquet Viewer"})]}),t.jsx(Ne,{mode:"horizontal",selectedKeys:[a],items:s,style:{flex:1,minWidth:0,justifyContent:"flex-end",border:"none",background:"transparent"}})]}),t.jsx(ut,{style:{padding:"8px",minHeight:"calc(100vh - 64px)",background:o.colorBgLayout},children:t.jsx("div",{style:{margin:"0 auto",background:o.colorBgContainer,padding:"4px 8px 4px 8px",borderRadius:o.borderRadiusLG,minHeight:"calc(100vh - 112px)"},children:e})})]})}const j=[];for(let e=0;e<256;++e)j.push((e+256).toString(16).slice(1));function pt(e,r=0){return(j[e[r+0]]+j[e[r+1]]+j[e[r+2]]+j[e[r+3]]+"-"+j[e[r+4]]+j[e[r+5]]+"-"+j[e[r+6]]+j[e[r+7]]+"-"+j[e[r+8]]+j[e[r+9]]+"-"+j[e[r+10]]+j[e[r+11]]+j[e[r+12]]+j[e[r+13]]+j[e[r+14]]+j[e[r+15]]).toLowerCase()}let J;const mt=new Uint8Array(16);function ft(){if(!J){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");J=crypto.getRandomValues.bind(crypto)}return J(mt)}const xt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),me={randomUUID:xt};function yt(e,r,n){var a;if(me.randomUUID&&!e)return me.randomUUID();e=e||{};const o=e.random??((a=e.rng)==null?void 0:a.call(e))??ft();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,pt(o)}async function se(e){const r=await fetch(`/test-fixtures/${e}`);if(!r.ok)throw new Error(`Failed to fetch test fixture: ${e}`);return await r.arrayBuffer()}function ae(e){return["small_test.parquet","multi_type_test.parquet","invalid_file.parquet"].includes(e)}const Fe=1e4,jt=3;function wt(e,r=Fe){const n=[];let o=0,a=0;for(let s=0;s<e.length;s++){const i=e[s]??0;if(i<=r)n.push({chunkId:a++,rowGroupIndex:s,rowGroupSize:i,rowGroupStartRow:0,rowGroupEndRow:i,globalStartRow:o,globalEndRow:o+i}),o+=i;else{let l=0;for(;l<i;){const c=Math.min(r,i-l);n.push({chunkId:a++,rowGroupIndex:s,rowGroupSize:i,rowGroupStartRow:l,rowGroupEndRow:l+c,globalStartRow:o,globalEndRow:o+c}),o+=c,l+=c}}}return{totalChunks:n.length,chunkSize:r,chunks:n}}function Le(e,r,n){const o=(e-1)*r,a=o+r,s=[];for(const i of n.chunks)i.globalEndRow>o&&i.globalStartRow<a&&s.push(i.chunkId);return s}function Pe(e,r){return r.chunks.find(n=>n.chunkId===e)}function bt(e,r,n,o){const a=(e-1)*r,s=a+r,l=Le(e,r,o).map(u=>{const d=Pe(u,o),h=n[u];return d&&h?{metadata:d,chunk:h}:null}).filter(u=>u!==null).sort((u,d)=>u.metadata.globalStartRow-d.metadata.globalStartRow),c=[];for(const{metadata:u,chunk:d}of l){const h=u.globalStartRow,g=Math.max(0,a-h),f=Math.min(d.rows.length,s-h);for(let x=g;x<f;x++){const m=d.rows[x];if(m){const y=h+x;c.push({...m,__rowIndex:y})}}}return c}function St(e,r,n=jt){const o=new Set(r),a=Object.entries(e).map(([d,h])=>({id:Number(d),chunk:h})).filter(d=>d.chunk!==void 0);if(a.length<=n)return e;const s=a.filter(d=>o.has(d.id)),i=a.filter(d=>!o.has(d.id));i.sort((d,h)=>d.chunk.lastAccessTime-h.chunk.lastAccessTime);const l=n-s.length,c=i.slice(-l),u={};for(const d of[...s,...c])u[d.id]=d.chunk;return u}function P(e){return{byteLength:e.size,slice(r,n){return e.slice(r,n).arrayBuffer()}}}async function Ct(e){const r=ie(e);if(!r.valid)throw new Error(r.error||"Invalid Parquet file");try{let n;if(ae(e.name))try{const u=await se(e.name);n={byteLength:u.byteLength,slice(d,h){return u.slice(d,h)}}}catch{n=P(e)}else n=P(e);const o=await st(n),a=at(o),s=a.children?Tt(a.children):[],i=o.row_groups.map(u=>Number(u.num_rows)),l=i.reduce((u,d)=>u+d,0),c=wt(i);return{id:yt(),name:e.name,size:e.size,loadedAt:new Date,metadata:Et(o),rawMetadata:o,columns:s,rowCount:l,rowGroupCount:o.row_groups.length,rowsPerGroup:i,chunkIndex:c,fileHandle:e}}catch(n){throw{message:`Failed to parse Parquet file: ${n instanceof Error?n.message:"Unknown error"}`,...n instanceof Error&&{originalError:n},fileName:e.name}}}async function kt(e,r,n,o){if(r<0||r>=o.length)throw new Error(`Invalid row group index: ${r}`);if(o[r]===void 0||o[r]<0)throw new Error(`Invalid row count for group ${r}`);try{let a;if(ae(e.name))try{const c=await se(e.name);a={byteLength:c.byteLength,slice(u,d){return c.slice(u,d)}}}catch{a=P(e)}else a=P(e);let s=0;for(let c=0;c<r;c++)s+=o[c]??0;const i=s+(o[r]??0);let l=[];return await Re({file:a,metadata:n,rowStart:s,rowEnd:i,compressors:Te,rowFormat:"object",onComplete:c=>{l=c}}),l}catch(a){throw{message:`Failed to load row group ${r}: ${a instanceof Error?a.message:"Unknown error"}`,...a instanceof Error&&{originalError:a},fileName:e.name}}}async function vt(e,r,n){try{let o;if(ae(e.name))try{const l=await se(e.name);o={byteLength:l.byteLength,slice(c,u){return l.slice(c,u)}}}catch{o=P(e)}else o=P(e);const a=r.globalStartRow,s=r.globalEndRow;let i=[];return await Re({file:o,metadata:n,rowStart:a,rowEnd:s,compressors:Te,rowFormat:"object",onComplete:l=>{i=l}}),{chunkId:r.chunkId,rowGroupIndex:r.rowGroupIndex,startRow:r.globalStartRow,endRow:r.globalEndRow,rows:i,lastAccessTime:Date.now()}}catch(o){throw{message:`Failed to load chunk ${r.chunkId}: ${o instanceof Error?o.message:"Unknown error"}`,...o instanceof Error&&{originalError:o},fileName:e.name}}}async function Rt(e,r,n,o){if((o[r.rowGroupIndex]??0)<=Fe){const s=await kt(e,r.rowGroupIndex,n,o);return{chunkId:r.chunkId,rowGroupIndex:r.rowGroupIndex,startRow:r.globalStartRow,endRow:r.globalEndRow,rows:s,lastAccessTime:Date.now()}}else return vt(e,r,n)}function Tt(e){const r=[],n=(o,a=[])=>{const s=o.element,i=[...a,s.name],l=i.join(".");if(s.type){const c=s.logical_type?s.logical_type.type:s.converted_type;r.push({name:l,type:s.type,nullable:s.repetition_type==="OPTIONAL",...c&&{logicalType:c}})}o.children&&o.children.length>0&&o.children.forEach(c=>n(c,i))};return e.forEach(o=>n(o)),r}function Et(e){const r=It(e.key_value_metadata);return{numRowGroups:e.row_groups.length,version:String(e.version),...e.created_by&&{createdBy:e.created_by},...r&&{keyValueMetadata:r}}}function It(e){if(!e||e.length===0)return;const r={};for(const n of e)n.key&&n.value&&(r[n.key]=n.value);return Object.keys(r).length>0?r:void 0}function ie(e){return e.name.toLowerCase().endsWith(".parquet")?e.size<100?{valid:!1,error:"File is too small to be a valid Parquet file"}:{valid:!0}:{valid:!1,error:"File must have .parquet extension"}}function Ft(){const[e,r]=p.useState(null),[n,o]=p.useState(!1),[a,s]=p.useState(null),i=p.useCallback(async c=>{s(null);const u=ie(c);if(!u.valid){s({message:u.error??"Invalid Parquet file",fileName:c.name});return}o(!0);try{const d=await Ct(c);r(d),s(null)}catch(d){Lt(d)?s(d):s({message:`Failed to load file: ${d instanceof Error?d.message:"Unknown error"}`,fileName:c.name}),r(null)}finally{o(!1)}},[]),l=p.useCallback(()=>{r(null),s(null),o(!1)},[]);return{file:e,loading:n,error:a,loadFile:i,clearFile:l}}function Lt(e){return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}function Pt(e,r=1e4){const n=[];return e.rowsPerGroup.forEach((o,a)=>{if(o>r){const s=o/e.rowCount*e.size;n.push({index:a,rows:o,sizeBytes:s})}}),n}const At={hideLargeFileWarning:!1};function fe(){return{...At}}const xe="parquet-viewer-preferences";class Dt{load(){try{const r=localStorage.getItem(xe);if(r){const n=JSON.parse(r);return{...fe(),...n}}}catch(r){console.error("Failed to load preferences from localStorage:",r)}return fe()}save(r){try{localStorage.setItem(xe,JSON.stringify(r))}catch(n){console.error("Failed to save preferences to localStorage:",n)}}update(r,n){const o=this.load();o[r]=n,this.save(o)}}const le=new Dt;function ee(){return le.load()}function $t(e){le.save(e)}function Bt(e,r){le.update(e,r)}function Ot(e){const[r,n]=p.useState(!1),[o,a]=p.useState([]);return p.useEffect(()=>{if(!e){n(!1),a([]);return}if(ee().hideLargeFileWarning){n(!1),a([]);return}const c=Pt(e);c.length>0?(a(c),n(!0)):(n(!1),a([]))},[e]),{showWarning:r,largeGroups:o,handleDismiss:()=>{n(!1)},handleDontShowAgain:()=>{Bt("hideLargeFileWarning",!0),n(!1)}}}const{Dragger:zt}=X,{Text:Mt,Paragraph:Nt,Title:qt}=v;function _t({mode:e,loading:r,onFileSelect:n,loadedButtonText:o}){const a=async i=>{const{file:l}=i,c=l.originFileObj||(l instanceof File?l:null);c&&await n(c)},s=i=>ie(i).valid?!1:X.LIST_IGNORE;return r?t.jsxs("div",{style:{textAlign:"center"},role:"status","aria-live":"polite","aria-label":"Loading file",children:[t.jsx(Ue,{size:"large"}),t.jsx(Nt,{style:{marginTop:"16px",color:"#999"},children:"Loading Parquet file metadata..."})]}):e==="initial"?t.jsx("div",{style:{padding:"24px"},children:t.jsxs(zt,{name:"file",multiple:!1,accept:".parquet",beforeUpload:s,onChange:a,showUploadList:!1,"data-testid":"file-upload-dragger","aria-label":"Upload Parquet file by clicking or dragging",children:[t.jsx("span",{children:t.jsx(Ge,{style:{fontSize:"64px",color:"#1890ff"}})}),t.jsx(qt,{level:2,children:"Click or drag Parquet file to this area"}),t.jsx("p",{className:"ant-upload-hint",style:{fontSize:"14px",color:"#999"},children:"The file will be processed locally in your browser - no data is uploaded to any server."}),t.jsx(Mt,{type:"secondary",children:"Data is loaded on demand to support large files."})]})}):t.jsx("div",{style:{marginBottom:"16px",textAlign:"right"},children:t.jsx(X,{name:"file",multiple:!1,accept:".parquet",beforeUpload:s,onChange:a,showUploadList:!1,children:t.jsx(W,{icon:t.jsx(We,{}),"aria-label":"Load a different Parquet file",children:o||"Load Different File"})})})}const{Text:q,Paragraph:ye}=v;function Ut({visible:e,error:r,onClose:n}){return r?t.jsxs(Ve,{title:t.jsxs("span",{children:[t.jsx(He,{style:{color:"#ff4d4f",marginRight:"8px"},"aria-hidden":"true"}),"Failed to Load Parquet File"]}),open:e,onCancel:n,onOk:n,cancelButtonProps:{style:{display:"none"}},okText:"Close","aria-labelledby":"error-modal-title","aria-describedby":"error-modal-description",children:[t.jsx(G,{message:"Error Loading File",description:r.message,type:"error",showIcon:!0,style:{marginBottom:"16px"}}),r.fileName&&t.jsxs(t.Fragment,{children:[t.jsx(L,{}),t.jsxs("div",{children:[t.jsx(q,{strong:!0,children:"File Name:"}),t.jsx("br",{}),t.jsx(q,{code:!0,children:r.fileName})]})]}),r.originalError&&t.jsxs(t.Fragment,{children:[t.jsx(L,{}),t.jsxs("div",{children:[t.jsx(q,{strong:!0,children:"Technical Details:"}),t.jsx(ye,{style:{marginTop:"8px"},children:t.jsx(q,{type:"secondary",style:{fontSize:"12px",fontFamily:"monospace"},children:r.originalError.message})})]})]}),t.jsx(L,{}),t.jsx(ye,{type:"secondary",style:{fontSize:"12px",marginBottom:0},children:"Please ensure the file is a valid Parquet file and try again."})]}):null}function Gt(e){if(e==null)return"null";if(e instanceof Date)return e.toISOString();if(typeof e=="boolean")return e?"true":"false";if(typeof e=="number")return Number.isInteger(e)?e.toLocaleString():e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6});if(typeof e=="bigint")return e.toString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return"[Object]"}return String(e)}function Wt(e){return typeof e=="number"||typeof e=="bigint"}function Vt(e){return typeof e=="boolean"}function Ht(e){return e==null}function Jt(e,r=100){return e.length<=r?e:e.slice(0,r)+"..."}function Kt(e,r=100){return e.length>r}function te(e){if(e===0)return"0 B";const r=["B","KB","MB","GB","TB"],n=1024,o=Math.floor(Math.log(e)/Math.log(n));return`${(e/Math.pow(n,o)).toFixed(2)} ${r[o]}`}function Yt(e,r){if(r)switch(r){case"UTF8":case"STRING":return"String";case"TIMESTAMP_MILLIS":case"TIMESTAMP_MICROS":return"Timestamp";case"DATE":return"Date";case"DECIMAL":return"Decimal";case"JSON":return"JSON";case"BSON":return"BSON";case"UUID":return"UUID";default:return r}switch(e){case"BOOLEAN":return"Boolean";case"INT32":return"Int32";case"INT64":return"Int64";case"FLOAT":return"Float";case"DOUBLE":return"Double";case"BYTE_ARRAY":return"ByteArray";case"FIXED_LEN_BYTE_ARRAY":return"FixedByteArray";default:return e}}const{Text:b,Paragraph:Xt}=v;function Zt({visible:e,file:r,largeGroups:n,onDismiss:o,onDontShowAgain:a}){return!e||!r||n.length===0?null:t.jsx(G,{message:"Large Row Groups Detected",description:t.jsxs(w,{vertical:!0,style:{width:"100%"},size:"small",children:[t.jsxs(b,{children:["This file contains ",n.length," large row group",n.length>1?"s":""," that will be automatically split into 10,000-row chunks and loaded on-demand for efficient memory usage."]}),t.jsx(W,{type:"link",size:"small",icon:t.jsx(Ce,{}),onClick:a,style:{paddingLeft:0},children:"Don't show again"}),t.jsx(oe,{ghost:!0,size:"small",items:[{key:"details",label:"View Details",children:t.jsxs(w,{vertical:!0,style:{width:"100%"},size:"middle",children:[t.jsxs("div",{children:[t.jsx(b,{strong:!0,children:"File:"})," ",t.jsx(b,{code:!0,children:r.name}),t.jsx("br",{}),t.jsx(b,{strong:!0,children:"Total Size:"})," ",t.jsx(b,{children:te(r.size)}),t.jsx("br",{}),t.jsx(b,{strong:!0,children:"Total Rows:"})," ",t.jsx(b,{children:r.rowCount.toLocaleString()}),t.jsx("br",{}),t.jsx(b,{strong:!0,children:"Row Groups:"})," ",t.jsx(b,{children:r.rowGroupCount})]}),t.jsxs("div",{children:[t.jsxs(b,{strong:!0,children:["Large Row Groups (",n.length,"):"]}),t.jsx(de,{size:"small",bordered:!0,dataSource:n,style:{marginTop:"4px"},renderItem:s=>t.jsx(de.Item,{children:t.jsxs(w,{style:{width:"100%",justifyContent:"space-between"},children:[t.jsxs("span",{children:[t.jsxs(b,{strong:!0,children:["Group ",s.index]}),t.jsxs(b,{type:"secondary",children:[" (",s.rows.toLocaleString()," rows)"]})]}),t.jsxs(b,{type:"warning",strong:!0,children:["~",te(s.sizeBytes)]})]})})})]}),t.jsx("div",{children:t.jsxs(Xt,{type:"secondary",style:{fontSize:"12px",marginBottom:0},children:[t.jsx("strong",{children:"How streaming works:"}),t.jsxs("ul",{style:{marginTop:"4px",paddingLeft:"20px"},children:[t.jsx("li",{children:"Row groups larger than 10,000 rows are split into chunks"}),t.jsx("li",{children:"Only the chunks needed for the current page are loaded"}),t.jsx("li",{children:"Memory usage is bounded regardless of file size"}),t.jsx("li",{children:"Older chunks are automatically evicted to maintain a 30,000-row cache"})]})]})})]})}]})]}),type:"info",showIcon:!0,icon:t.jsx(Je,{}),closable:!0,onClose:o,style:{marginBottom:"16px"}})}var K,je;function Qt(){return je||(je=1,K=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var r=document.activeElement,n=[],o=0;o<e.rangeCount;o++)n.push(e.getRangeAt(o));switch(r.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":r.blur();break;default:r=null;break}return e.removeAllRanges(),function(){e.type==="Caret"&&e.removeAllRanges(),e.rangeCount||n.forEach(function(a){e.addRange(a)}),r&&r.focus()}}),K}var Y,we;function er(){if(we)return Y;we=1;var e=Qt(),r={"text/plain":"Text","text/html":"Url",default:"Text"},n="Copy to clipboard: #{key}, Enter";function o(s){var i=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return s.replace(/#{\s*key\s*}/g,i)}function a(s,i){var l,c,u,d,h,g,f=!1;i||(i={}),l=i.debug||!1;try{u=e(),d=document.createRange(),h=document.getSelection(),g=document.createElement("span"),g.textContent=s,g.ariaHidden="true",g.style.all="unset",g.style.position="fixed",g.style.top=0,g.style.clip="rect(0, 0, 0, 0)",g.style.whiteSpace="pre",g.style.webkitUserSelect="text",g.style.MozUserSelect="text",g.style.msUserSelect="text",g.style.userSelect="text",g.addEventListener("copy",function(m){if(m.stopPropagation(),i.format)if(m.preventDefault(),typeof m.clipboardData>"u"){l&&console.warn("unable to use e.clipboardData"),l&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var y=r[i.format]||r.default;window.clipboardData.setData(y,s)}else m.clipboardData.clearData(),m.clipboardData.setData(i.format,s);i.onCopy&&(m.preventDefault(),i.onCopy(m.clipboardData))}),document.body.appendChild(g),d.selectNodeContents(g),h.addRange(d);var x=document.execCommand("copy");if(!x)throw new Error("copy command was unsuccessful");f=!0}catch(m){l&&console.error("unable to copy using execCommand: ",m),l&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(i.format||"text",s),i.onCopy&&i.onCopy(window.clipboardData),f=!0}catch(y){l&&console.error("unable to copy using clipboardData: ",y),l&&console.error("falling back to prompt"),c=o("message"in i?i.message:n),window.prompt(c,s)}}finally{h&&(typeof h.removeRange=="function"?h.removeRange(d):h.removeAllRanges()),g&&document.body.removeChild(g),u()}return f}return Y=a,Y}var tr=er();const Ae=Be(tr),{Text:S}=v;function rr(e){try{const r=JSON.parse(e);if(r!==null&&typeof r=="object")return r}catch{}return null}const re=(e,r="root",n="",o=0,a=10,s)=>{const i=n?`${n}.${r}`:String(r);if(o>a)return{key:i,title:t.jsxs("span",{children:[t.jsxs(S,{type:"secondary",children:[r,": "]}),t.jsx(S,{type:"warning",children:"[Maximum depth reached]"})]}),isLeaf:!0};if(e==null)return{key:i,title:t.jsxs("span",{children:[t.jsxs(S,{type:"secondary",children:[r,": "]}),t.jsx(S,{type:"secondary",children:String(e)})]}),isLeaf:!0};if(typeof e!="object"){const f=typeof e=="string"?`"${e}"`:String(e);return{key:i,title:t.jsxs("span",{children:[t.jsxs(S,{type:"secondary",children:[r,": "]}),t.jsx(S,{style:{color:typeof e=="number"?s.colorWarning:typeof e=="boolean"?s.colorInfo:s.colorSuccess},children:f})]}),isLeaf:!0}}if(Array.isArray(e)){const x=Math.min(e.length,100),m=e.length>100,y=e.slice(0,x).map((E,I)=>re(E,`[${I}]`,i,o+1,a,s));m&&y.push({key:`${i}.$more`,title:t.jsxs(S,{type:"warning",children:["... ",e.length-100," more items (showing first ",100,")"]}),isLeaf:!0});const A={key:i,title:t.jsxs("span",{children:[t.jsxs(S,{type:"secondary",children:[r,": "]}),t.jsxs(S,{strong:!0,children:["Array(",e.length,")"]})]}),isLeaf:y.length===0};return y.length>0&&(A.children=y),A}const l=Object.entries(e),c=100,u=Math.min(l.length,c),d=l.length>c,h=l.slice(0,u).map(([f,x])=>re(x,f,i,o+1,a,s));d&&h.push({key:`${i}.$more`,title:t.jsxs(S,{type:"warning",children:["... ",l.length-c," more properties (showing first ",c,")"]}),isLeaf:!0});const g={key:i,title:t.jsxs("span",{children:[t.jsxs(S,{type:"secondary",children:[r,": "]}),t.jsxs(S,{strong:!0,children:["Object(",l.length,")"]})]}),isLeaf:h.length===0};return h.length>0&&(g.children=h),g};function nr({metadata:e}){const{token:r}=B.useToken(),n=p.useMemo(()=>{if(!e||Object.keys(e).length===0)return[];const o={};for(const[a,s]of Object.entries(e)){const i=rr(s);i!==null?o[a]=i:o[a]=s}return Object.entries(o).map(([a,s])=>re(s,a,"",0,10,r))},[e,r]);return!e||Object.keys(e).length===0?t.jsx("span",{style:{color:"#8c8c8c",fontStyle:"italic"},children:"No custom metadata"}):t.jsx("div",{style:{padding:"8px",borderRadius:"4px",backgroundColor:r.colorBgContainer,border:`1px solid ${r.colorBorder}`,maxHeight:"400px",overflow:"auto"},children:t.jsx(Ke,{showLine:!0,defaultExpandAll:!0,treeData:n,blockNode:!0,style:{backgroundColor:"transparent"}})})}const{Text:_}=v,{useApp:or}=ke;function sr({file:e,defaultExpanded:r=!0}){const[n,o]=p.useState(r?["1","2","3"]:[]),{message:a}=or(),s=()=>{const l={fileName:e.name,fileSize:e.size,rowCount:e.rowCount,rowGroupCount:e.rowGroupCount,rowsPerGroup:e.rowsPerGroup,columns:e.columns,metadata:e.metadata,loadedAt:e.loadedAt.toISOString()};Ae(JSON.stringify(l,null,2))?a.success("Metadata copied to clipboard"):a.error("Failed to copy metadata")},i=[{title:"Column Name",dataIndex:"name",key:"name",render:l=>t.jsx(_,{code:!0,children:l})},{title:"Type",dataIndex:"type",key:"type",render:(l,c)=>t.jsx(_,{style:{color:"#1890ff"},children:Yt(l,c.logicalType)})},{title:"Nullable",dataIndex:"nullable",key:"nullable",render:l=>l?"Yes":"No"}];return t.jsxs("div",{style:{marginBottom:"16px"},children:[t.jsxs(w,{style:{marginBottom:"8px",width:"100%",justifyContent:"space-between"},children:[t.jsxs(w,{children:[t.jsx(Se,{}),t.jsx(_,{strong:!0,children:"File Information"})]}),t.jsx(W,{size:"small",icon:t.jsx(ve,{}),onClick:s,children:"Copy Metadata as JSON"})]}),t.jsx(oe,{activeKey:n,onChange:l=>o(l),accordion:!1,items:[{key:"1",label:"Basic Information",children:t.jsxs(C,{column:1,size:"small",bordered:!0,children:[t.jsx(C.Item,{label:"File Name",children:e.name}),t.jsx(C.Item,{label:"File Size",children:te(e.size)}),t.jsx(C.Item,{label:"Total Rows",children:e.rowCount.toLocaleString()}),t.jsx(C.Item,{label:"Row Groups",children:e.rowGroupCount}),t.jsx(C.Item,{label:"Loaded At",children:e.loadedAt.toLocaleString()})]})},{key:"2",label:`Schema (${e.columns.length} columns)`,children:t.jsx(Z,{dataSource:e.columns,columns:i,rowKey:"name",size:"small",pagination:!1,scroll:{y:300}})},{key:"3",label:"File Metadata",children:t.jsxs(t.Fragment,{children:[t.jsxs(C,{column:1,size:"small",bordered:!0,children:[t.jsx(C.Item,{label:"Parquet Version",children:e.metadata.version}),t.jsx(C.Item,{label:"Created By",children:e.metadata.createdBy||"Unknown"}),t.jsx(C.Item,{label:"Row Groups",children:e.metadata.numRowGroups}),e.metadata.keyValueMetadata&&t.jsx(C.Item,{label:"Custom Metadata",children:t.jsx(nr,{metadata:e.metadata.keyValueMetadata})})]}),t.jsxs("div",{style:{marginTop:"16px"},children:[t.jsx(_,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"Row Group Distribution:"}),t.jsx(Z,{dataSource:e.rowsPerGroup.map((l,c)=>({index:c,rows:l,percentage:(l/e.rowCount*100).toFixed(1)})),columns:[{title:"Group",dataIndex:"index",key:"index"},{title:"Rows",dataIndex:"rows",key:"rows",render:l=>l.toLocaleString()},{title:"Percentage",dataIndex:"percentage",key:"percentage",render:l=>`${l}%`}],size:"small",pagination:!1,scroll:{y:200},rowKey:"index"})]})]})}]})]})}function ar(e){const[r,n]=p.useState({}),[o,a]=p.useState(!1),[s,i]=p.useState(1),[l,c]=p.useState(500);p.useEffect(()=>{n({}),i(1)},[e==null?void 0:e.id]);const u=p.useCallback(async(f,x)=>{if(!e)return;const m=x??l;a(!0);try{const y=Le(f,m,e.chunkIndex),A=y.filter(E=>!r[E]);if(A.length>0){const E=A.map(async R=>{const k=Pe(R,e.chunkIndex);if(!k)throw new Error(`Chunk metadata not found for chunk ${R}`);const F=await Rt(e.fileHandle,k,e.rawMetadata,e.rowsPerGroup);return{chunkId:R,chunk:F}}),I=await Promise.all(E);n(R=>{const k={...R};for(const{chunkId:F,chunk:O}of I)k[F]=O;for(const F of y){const O=k[F];O&&(k[F]={...O,lastAccessTime:Date.now()})}return St(k,y)})}else n(E=>{const I={...E};for(const R of y){const k=I[R];k&&(I[R]={...k,lastAccessTime:Date.now()})}return I});i(f),x!==void 0&&c(x)}catch(y){throw console.error("Failed to load chunks:",y),y}finally{a(!1)}},[e,l,r]),d=p.useMemo(()=>e?bt(s,l,r,e.chunkIndex):[],[e,s,l,r]),h=p.useCallback(()=>{n({})},[]),g=p.useMemo(()=>{const f=Object.values(r).filter(x=>x!==void 0);return{chunkCount:f.length,totalRows:f.reduce((x,m)=>x+((m==null?void 0:m.rows.length)??0),0)}},[r]);return{currentPageRows:d,loading:o,currentPage:s,pageSize:l,changePage:u,clearCache:h,cacheStats:g}}function ir({value:e,maxLength:r=100}){if(Ht(e))return t.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"null"});if(Vt(e))return t.jsx(Ye,{color:e?"green":"default",children:String(e)});const n=Gt(e);return Wt(e)?t.jsx("div",{style:{textAlign:"right",fontFamily:"monospace"},children:n}):Kt(n,r)?t.jsx(lr,{value:n,maxLength:r}):t.jsx("span",{children:n})}function lr({value:e,maxLength:r}){const n=()=>{Ae(e)?ue.success("Copied to clipboard"):ue.error("Failed to copy")},o=t.jsxs("div",{style:{maxWidth:"400px",maxHeight:"300px",overflow:"auto"},children:[t.jsx("pre",{style:{margin:0,marginBottom:"8px",fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e}),t.jsx(W,{size:"small",icon:t.jsx(ve,{}),onClick:n,block:!0,children:"Copy to Clipboard"})]});return t.jsx(Xe,{content:o,title:"Full Value",trigger:"click",placement:"topLeft",children:t.jsx(Ze,{title:"Click to view full value",children:t.jsx("span",{style:{cursor:"pointer",color:"#1890ff",textDecoration:"underline",textDecorationStyle:"dotted"},children:Jt(e,r)})})})}function cr(e,r){return{title:r||e,dataIndex:e,key:e,render:n=>t.jsx(ir,{value:n}),sorter:(n,o)=>{const a=n[e],s=o[e];return a==null?-1:s==null?1:typeof a=="number"&&typeof s=="number"?a-s:String(a).localeCompare(String(s))}}}const{Text:T}=v;function dr({file:e,error:r}){const{currentPageRows:n,loading:o,currentPage:a,pageSize:s,changePage:i,clearCache:l}=ar(e);p.useEffect(()=>{l(),i(1,500).catch(d=>{console.error("Failed to load first page:",d)})},[e.id]);const c=async(d,h)=>{try{await i(d,h)}catch(g){console.error("Failed to change page:",g)}},u=e.columns.map(d=>cr(d.name,d.name));return r?t.jsx(G,{title:"Error Loading Data",description:r,type:"error",showIcon:!0}):!o&&n.length===0&&a===1?t.jsx(G,{title:"No Data",description:"This Parquet file appears to be empty or the first page could not be loaded.",type:"info",showIcon:!0}):t.jsxs("div",{children:[t.jsxs(w,{style:{marginBottom:"16px"},role:"status","aria-live":"polite",children:[t.jsxs(T,{children:[t.jsx(T,{strong:!0,children:"Showing rows:"})," ",((a-1)*s+1).toLocaleString()," -"," ",Math.min(a*s,e.rowCount).toLocaleString()," of ",e.rowCount.toLocaleString()]}),t.jsx(T,{type:"secondary","aria-hidden":"true",children:"|"}),t.jsxs(T,{children:[t.jsx(T,{strong:!0,children:"Columns:"})," ",e.columns.length]}),t.jsx(T,{type:"secondary","aria-hidden":"true",children:"|"}),t.jsxs(T,{children:[t.jsx(T,{strong:!0,children:"Row Groups:"})," ",e.rowGroupCount]})]}),t.jsx(Z,{columns:u,dataSource:n,rowKey:d=>`row-${d.__rowIndex}`,loading:o,"aria-label":`Parquet data table with ${e.rowCount} rows and ${e.columns.length} columns`,pagination:{current:a,pageSize:s,total:e.rowCount,showSizeChanger:!0,pageSizeOptions:["100","500","1000","2000"],showTotal:(d,h)=>`${h[0]}-${h[1]} of ${d} rows`,onChange:c,onShowSizeChange:c},scroll:{x:e.columns.length*150,y:600},virtual:!0,size:"small",bordered:!0,sticky:!0})]})}function ur(){const{file:e,loading:r,error:n,loadFile:o,clearFile:a}=Ft(),{showWarning:s,largeGroups:i,handleDismiss:l,handleDontShowAgain:c}=Ot(e),u=async g=>{try{await o(g)}catch(f){console.error("Error loading file:",f)}},d=()=>{a()},h=e?"loaded":"initial";return t.jsxs("main",{role:"main","aria-label":"Parquet File Viewer",children:[t.jsx(_t,{mode:h,loading:r,onFileSelect:u}),e&&t.jsxs(t.Fragment,{children:[t.jsx(L,{}),t.jsx(Zt,{visible:s,file:e,largeGroups:i,onDismiss:l,onDontShowAgain:c}),t.jsx(sr,{file:e,defaultExpanded:!0}),t.jsx(L,{}),t.jsx(dr,{file:e})]}),t.jsx(Ut,{visible:!!n&&!r,error:n,onClose:d})]})}function hr(){const[e,r]=p.useState(ee),n=o=>{r(a=>{const s={...a,...o};return $t(s),s})};return p.useEffect(()=>{const o=ee();r(o)},[]),{preferences:e,setPreferences:n}}const{Text:ne}=v,U=({name:e,value:r})=>{const n=String(r),o=typeof r=="string"&&(n.startsWith("#")||n.startsWith("rgb")||n.startsWith("hsl"));return t.jsx("div",{style:{marginBottom:12},children:t.jsxs(w,{align:"start",style:{width:"100%"},children:[o&&t.jsx("div",{style:{width:40,height:40,backgroundColor:n,border:"1px solid #d9d9d9",borderRadius:4,flexShrink:0}}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsx(ne,{strong:!0,style:{display:"block"},children:e}),t.jsx(ne,{type:"secondary",style:{fontSize:12,fontFamily:"monospace",display:"block",wordBreak:"break-all"},children:n})]})]})})},gr=()=>{const{token:e}=B.useToken(),r={},n={},o={},a={};Object.entries(e).forEach(([i,l])=>{const c=i.toLowerCase();c.includes("color")||c.includes("bg")?r[i]=l:c.includes("size")||c.includes("width")||c.includes("height")||c.includes("margin")||c.includes("padding")||c.includes("radius")?n[i]=l:c.includes("font")||c.includes("line")||c.includes("text")?o[i]=l:a[i]=l});const s=[{key:"colors",label:`Colors & Backgrounds (${Object.keys(r).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(r).map(([i,l])=>t.jsx(N,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})},{key:"sizes",label:`Sizes & Spacing (${Object.keys(n).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(n).map(([i,l])=>t.jsx(N,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})},{key:"fonts",label:`Typography (${Object.keys(o).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(o).map(([i,l])=>t.jsx(N,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})},{key:"other",label:`Other Tokens (${Object.keys(a).length})`,children:t.jsx(M,{gutter:[16,16],children:Object.entries(a).map(([i,l])=>t.jsx(N,{xs:24,sm:12,md:8,lg:6,children:t.jsx(U,{name:i,value:l})},i))})}];return t.jsx(Q,{title:t.jsxs(w,{children:[t.jsx(Qe,{}),"Theme Tokens"]}),children:t.jsxs(w,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[t.jsx(ne,{type:"secondary",children:"Explore all design tokens from the current Ant Design theme. These values are automatically generated based on your selected theme (light/dark) and can be used throughout the application."}),t.jsx(oe,{items:s,defaultActiveKey:[]})]})})},{Title:pr,Paragraph:mr,Text:$}=v;function fr(){const{mode:e,setMode:r}=Ie(),{preferences:n,setPreferences:o}=hr(),a=i=>{r(i?"dark":"light")},s=i=>{o({hideLargeFileWarning:!i})};return t.jsxs("div",{style:{padding:"8px",maxWidth:"1200px",margin:"0 auto"},children:[t.jsx(pr,{level:2,children:"Settings"}),t.jsx(mr,{children:"Customize your Parquet Viewer experience. Settings are automatically saved to your browser's local storage."}),t.jsx(Q,{title:t.jsxs(w,{children:[e==="dark"?t.jsx(et,{}):t.jsx(tt,{}),t.jsx("span",{children:"Appearance"})]}),style:{marginBottom:"8px"},children:t.jsxs(w,{orientation:"vertical",size:"small",style:{width:"100%"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx($,{strong:!0,children:"Dark Mode"}),t.jsx("br",{}),t.jsx($,{type:"secondary",children:"Toggle between light and dark theme"})]}),t.jsx(he,{checked:e==="dark",onChange:a})]}),t.jsx(L,{}),t.jsx($,{type:"secondary",children:"Your theme preference is saved to browser local storage and will persist across sessions."})]})}),t.jsx(Q,{title:t.jsxs(w,{children:[n.hideLargeFileWarning?t.jsx(Ce,{}):t.jsx(rt,{}),t.jsx("span",{children:"Notifications"})]}),style:{marginBottom:"8px"},children:t.jsx(w,{orientation:"vertical",size:"small",style:{width:"100%"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx($,{strong:!0,children:"Show Large File Warning"}),t.jsx("br",{}),t.jsx($,{type:"secondary",children:"Display an informational banner when files contain large row groups (>100MB)"})]}),t.jsx(he,{checked:!n.hideLargeFileWarning,onChange:s})]})})}),t.jsx(gr,{})]})}function xr(){const{mode:e}=Ie();return t.jsx(nt,{theme:{algorithm:e==="dark"?B.darkAlgorithm:B.defaultAlgorithm},children:t.jsx(ke,{children:t.jsx(Oe,{children:t.jsx(gt,{children:t.jsxs(ze,{children:[t.jsx(z,{path:"/",element:t.jsx(ce,{to:"/viewer",replace:!0})}),t.jsx(z,{path:"/viewer",element:t.jsx(ur,{})}),t.jsx(z,{path:"/settings",element:t.jsx(fr,{})}),t.jsx(z,{path:"*",element:t.jsx(ce,{to:"/",replace:!0})})]})})})})})}function yr(){return t.jsx(ct,{children:t.jsx(xr,{})})}ot.createRoot(document.getElementById("root")).render(t.jsx(Me.StrictMode,{children:t.jsx(yr,{})}));
